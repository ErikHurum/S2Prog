###############################################################################
#
# IAR C/C++ Compiler V7.30.4.1668 for Microchip AVR       12/Jul/2021  09:53:18
# Copyright 1996-2021 IAR Systems AB.
# Mobile license - IAR Embedded Workbench for Microchip AVR 7.30
#
#    Source file  =  D:\S2Prog\IO\AN_SGCNV\SW\AN-ZBXXX\ANZB\Src\ExtInt.c
#    Command line =  
#        -f C:\Users\ESY\AppData\Local\Temp\EW54F3.tmp
#        (D:\S2Prog\IO\AN_SGCNV\SW\AN-ZBXXX\ANZB\Src\ExtInt.c --cpu=m128a -ms
#        -o D:\S2Prog\IO\AN_SGCNV\SW\AN-ZBXXX\ANZB\Debug\Obj -D OS_LIBMODE_R -D
#        OS_UART=-1 -lCN D:\S2Prog\IO\AN_SGCNV\SW\AN-ZBXXX\ANZB\Debug\List -y
#        --initializers_in_flash --no_cse --no_inline --no_code_motion
#        --no_cross_call --no_clustering --no_tbaa --debug
#        -DENABLE_BIT_DEFINITIONS -e -I
#        D:\S2Prog\IO\AN_SGCNV\SW\AN-ZBXXX\ANZB\INC\\ -I
#        D:\S2Prog\IO\AN_SGCNV\SW\AN-ZBXXX\ANZB\..\..\SHARED\INC\\
#        --eeprom_size 4096 --clib -On)
#    Locale       =  Norwegian Bokmål_NOR.1252
#    List file    =  
#        D:\S2Prog\IO\AN_SGCNV\SW\AN-ZBXXX\ANZB\Debug\List\ExtInt.lst
#    Object file  =  
#        D:\S2Prog\IO\AN_SGCNV\SW\AN-ZBXXX\ANZB\Debug\Obj\ExtInt.r90
#
###############################################################################

D:\S2Prog\IO\AN_SGCNV\SW\AN-ZBXXX\ANZB\Src\ExtInt.c
      1          /****************************************************************************************
      2          / AD converter handling , AD7715
      3          /
      4          ***************************************************************************************/
      5          
      6          #include "iom128a.h"
      7          #include "stdio.h"
      8          #include "math.h"
      9          #include "externals.h"
     10          
     11          /*************************************************************************
     12          *
     13          *  External int 0 (UART PC16554 on AN-ZB485 or ADready on AN-ZBANA)
     14          *
     15          *************************************************************************/
     16          #pragma vector=INT0_vect

   \                                 In  segment CODE, align 2, keep-with-next
     17          __interrupt void IntHandler_INT0( void ){               //Int handler for ext int 0
   \                     IntHandler_INT0:
   \   00000000   939A               ST      -Y, R25
   \   00000002   938A               ST      -Y, R24
   \   00000004   93FA               ST      -Y, R31
   \   00000006   93EA               ST      -Y, R30
   \   00000008   923A               ST      -Y, R3
   \   0000000A   922A               ST      -Y, R2
   \   0000000C   921A               ST      -Y, R1
   \   0000000E   920A               ST      -Y, R0
   \   00000010   937A               ST      -Y, R23
   \   00000012   936A               ST      -Y, R22
   \   00000014   935A               ST      -Y, R21
   \   00000016   934A               ST      -Y, R20
   \   00000018   933A               ST      -Y, R19
   \   0000001A   932A               ST      -Y, R18
   \   0000001C   931A               ST      -Y, R17
   \   0000001E   930A               ST      -Y, R16
   \   00000020   B78F               IN      R24, 0x3F
   \   00000022   B79B               IN      R25, 0x3B
     18          
     19              // OBS!!!
     20              // Uses UART16552[].TxStatus as intreason and
     21              // UART16552[].TxSeqCnt as counter because these needs to be globale 
     22              // by using OS_EnterIntStack()
     23          
     24              
     25              OS_EnterInterrupt();
   \   00000024   9100....           LDS     R16, OS_Counters
   \   00000028   9503               INC     R16
   \   0000002A   9300....           STS     OS_Counters, R16
   \   0000002E   9100....           LDS     R16, (OS_Counters + 1)
   \   00000032   9503               INC     R16
   \   00000034   9300....           STS     (OS_Counters + 1), R16
     26              OS_EnterIntStack();
   \   00000038   94F8               CLI
   \   0000003A   ........           CALL    OS__EnterIntStack
   \   0000003E   9100....           LDS     R16, (OS_Counters + 1)
   \   00000042   2300               TST     R16
   \   00000044   F409               BRNE    ??IntHandler_INT0_0
   \   00000046   9478               SEI
     27          
     28              switch (UnitID) {
   \                     ??IntHandler_INT0_0:
   \   00000048   9100....           LDS     R16, UnitID
   \   0000004C   3004               CPI     R16, 4
     29              case AN_SGCNV:                  // AN-ZBANA ADready
     30                  //
     31                  break;
     32              }
     33              OS_LeaveIntStack();
   \   0000004E   94F8               CLI
   \   00000050   ........           CALL    OS__LeaveIntStack
     34              OS_LeaveInterruptNoSwitch();
   \   00000054   9100....           LDS     R16, (OS_Counters + 1)
   \   00000058   950A               DEC     R16
   \   0000005A   9300....           STS     (OS_Counters + 1), R16
   \   0000005E   9100....           LDS     R16, OS_Counters
   \   00000062   950A               DEC     R16
   \   00000064   9300....           STS     OS_Counters, R16
     35          
     36          }
   \   00000068   BF9B               OUT     0x3B, R25
   \   0000006A   BF8F               OUT     0x3F, R24
   \   0000006C   9109               LD      R16, Y+
   \   0000006E   9119               LD      R17, Y+
   \   00000070   9129               LD      R18, Y+
   \   00000072   9139               LD      R19, Y+
   \   00000074   9149               LD      R20, Y+
   \   00000076   9159               LD      R21, Y+
   \   00000078   9169               LD      R22, Y+
   \   0000007A   9179               LD      R23, Y+
   \   0000007C   9009               LD      R0, Y+
   \   0000007E   9019               LD      R1, Y+
   \   00000080   9029               LD      R2, Y+
   \   00000082   9039               LD      R3, Y+
   \   00000084   91E9               LD      R30, Y+
   \   00000086   91F9               LD      R31, Y+
   \   00000088   9189               LD      R24, Y+
   \   0000008A   9199               LD      R25, Y+
   \   0000008C   9518               RETI
     37          
     38          
     39          /*************************************************************************
     40          *
     41          *  External int 1 (UART PC16554 on AN-ZB485)
     42          *
     43          *************************************************************************/

   \                                 In  segment NEAR_Z, align 1, keep-with-next
   \   00000000                      REQUIRE `?<Segment init: NEAR_Z>`
     44          long IntCnt  = 0;
   \                     IntCnt:
   \   00000000                      DS8 4
     45          
     46          #pragma vector=INT1_vect
     47          

   \                                 In  segment CODE, align 2, keep-with-next
     48          __interrupt void IntHandler_INT1( void ){               //Int handler for Ext int 1
   \                     IntHandler_INT1:
   \   00000000   939A               ST      -Y, R25
   \   00000002   938A               ST      -Y, R24
   \   00000004   93FA               ST      -Y, R31
   \   00000006   93EA               ST      -Y, R30
   \   00000008   923A               ST      -Y, R3
   \   0000000A   922A               ST      -Y, R2
   \   0000000C   921A               ST      -Y, R1
   \   0000000E   920A               ST      -Y, R0
   \   00000010   937A               ST      -Y, R23
   \   00000012   936A               ST      -Y, R22
   \   00000014   935A               ST      -Y, R21
   \   00000016   934A               ST      -Y, R20
   \   00000018   933A               ST      -Y, R19
   \   0000001A   932A               ST      -Y, R18
   \   0000001C   931A               ST      -Y, R17
   \   0000001E   930A               ST      -Y, R16
   \   00000020   B78F               IN      R24, 0x3F
   \   00000022   B79B               IN      R25, 0x3B
     49          
     50              // OBS!!!
     51              // Uses UART16552[].TxStatus as intreason and
     52              // UART16552[].TxSeqCnt as counter because these needs to be globale 
     53              // by using OS_EnterIntStack()
     54              
     55            
     56              OS_EnterInterrupt();
   \   00000024   9100....           LDS     R16, OS_Counters
   \   00000028   9503               INC     R16
   \   0000002A   9300....           STS     OS_Counters, R16
   \   0000002E   9100....           LDS     R16, (OS_Counters + 1)
   \   00000032   9503               INC     R16
   \   00000034   9300....           STS     (OS_Counters + 1), R16
     57              //OS_EnterIntStack();
     58              IntCnt++;
   \   00000038   ....               LDI     R30, LOW(IntCnt)
   \   0000003A   ....               LDI     R31, (IntCnt) >> 8
   \   0000003C   8100               LD      R16, Z
   \   0000003E   8111               LDD     R17, Z+1
   \   00000040   8122               LDD     R18, Z+2
   \   00000042   8133               LDD     R19, Z+3
   \   00000044   5F0F               SUBI    R16, 255
   \   00000046   4F1F               SBCI    R17, 255
   \   00000048   4F2F               SBCI    R18, 255
   \   0000004A   4F3F               SBCI    R19, 255
   \   0000004C   8300               ST      Z, R16
   \   0000004E   8311               STD     Z+1, R17
   \   00000050   8322               STD     Z+2, R18
   \   00000052   8333               STD     Z+3, R19
     59              switch (UnitID) {
   \   00000054   9100....           LDS     R16, UnitID
   \   00000058   3004               CPI     R16, 4
   \   0000005A   F429               BRNE    ??IntHandler_INT1_0
     60          	case AN_SGCNV:                  // AN-ZBANA Not connected!
     61          		OS_SignalEvent(1, &TCB_AD7715);
   \   0000005C   ....               LDI     R18, LOW(TCB_AD7715)
   \   0000005E   ....               LDI     R19, (TCB_AD7715) >> 8
   \   00000060   E001               LDI     R16, 1
   \   00000062   ........           CALL    OS_SignalEvent
     62                  break;
     63              }
     64              //OS_LeaveIntStack();
     65              OS_LeaveInterruptNoSwitch();
   \                     ??IntHandler_INT1_0:
   \   00000066   9100....           LDS     R16, (OS_Counters + 1)
   \   0000006A   950A               DEC     R16
   \   0000006C   9300....           STS     (OS_Counters + 1), R16
   \   00000070   9100....           LDS     R16, OS_Counters
   \   00000074   950A               DEC     R16
   \   00000076   9300....           STS     OS_Counters, R16
     66          }
   \   0000007A   BF9B               OUT     0x3B, R25
   \   0000007C   BF8F               OUT     0x3F, R24
   \   0000007E   9109               LD      R16, Y+
   \   00000080   9119               LD      R17, Y+
   \   00000082   9129               LD      R18, Y+
   \   00000084   9139               LD      R19, Y+
   \   00000086   9149               LD      R20, Y+
   \   00000088   9159               LD      R21, Y+
   \   0000008A   9169               LD      R22, Y+
   \   0000008C   9179               LD      R23, Y+
   \   0000008E   9009               LD      R0, Y+
   \   00000090   9019               LD      R1, Y+
   \   00000092   9029               LD      R2, Y+
   \   00000094   9039               LD      R3, Y+
   \   00000096   91E9               LD      R30, Y+
   \   00000098   91F9               LD      R31, Y+
   \   0000009A   9189               LD      R24, Y+
   \   0000009C   9199               LD      R25, Y+
   \   0000009E   9518               RETI

   \                                 In  segment INTVEC, offset 0x4, root
   \                     `??IntHandler_INT0::??INTVEC 4`:
   \   00000004   ........           JMP     IntHandler_INT0

   \                                 In  segment INTVEC, offset 0x8, root
   \                     `??IntHandler_INT1::??INTVEC 8`:
   \   00000008   ........           JMP     IntHandler_INT1

   Maximum stack usage in bytes:

   CSTACK RSTACK Function
   ------ ------ --------
     16      2   IntHandler_INT0
       16      2   -> OS__EnterIntStack
       16      2   -> OS__LeaveIntStack
     16      2   IntHandler_INT1
       16      2   -> OS_SignalEvent


   Segment part sizes:

   Bytes  Function/Label
   -----  --------------
       4  IntCnt
     142  IntHandler_INT0
       4  IntHandler_INT0::??INTVEC 4
     160  IntHandler_INT1
       4  IntHandler_INT1::??INTVEC 8
       7  -- Other

 
 302 bytes in segment CODE
   7 bytes in segment INITTAB
   8 bytes in segment INTVEC
   4 bytes in segment NEAR_Z
 
 302 bytes of CODE memory (+ 15 bytes shared)
   4 bytes of DATA memory

Errors: none
Warnings: none
