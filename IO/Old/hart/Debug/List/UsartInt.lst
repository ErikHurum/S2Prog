###############################################################################
#
# IAR C/C++ Compiler V7.30.5.1680 for Microchip AVR       15/Dec/2022  12:17:27
# Copyright 1996-2022 IAR Systems AB.
# Mobile license - IAR Embedded Workbench for Microchip AVR 7.30
#
#    Source file  =  D:\S2Prog\IO\hart\Src\UsartInt.c
#    Command line =  
#        -f C:\Users\ESY\AppData\Local\Temp\EW583D.tmp
#        (D:\S2Prog\IO\hart\Src\UsartInt.c --cpu=m1280 -ms -o
#        D:\S2Prog\IO\hart\Debug\Obj -D OS_LIBMODE_D -D OS_UART=-1 -D DEBUG
#        -lCN D:\S2Prog\IO\hart\Debug\List -y --initializers_in_flash --no_cse
#        --no_inline --no_code_motion --no_cross_call --no_clustering --no_tbaa
#        --debug -DENABLE_BIT_DEFINITIONS -e -I D:\S2Prog\IO\hart\INC\\ -I
#        ..\..\..\Shared\Inc\\ --eeprom_size 4096 --clib -On)
#    Locale       =  Norwegian Bokmål_NOR.1252
#    List file    =  D:\S2Prog\IO\hart\Debug\List\UsartInt.lst
#    Object file  =  D:\S2Prog\IO\hart\Debug\Obj\UsartInt.r90
#
###############################################################################

D:\S2Prog\IO\hart\Src\UsartInt.c
      1          /****************************************************************************************
      2          / USART1 functions and interrupt
      3          /   This routines sync and check the ANPRO10
      4          /   Uart1Pro.c handle the package
      5          /
      6          ***************************************************************************************/
      7          
      8          
      9          #include "iom1280.h"

   \                                 In  segment ABSOLUTE, at 0xc6
   \   union <unnamed> volatile __io _A_UDR0
   \                     _A_UDR0:
   \   00000000                      DS8 1

   \                                 In  segment ABSOLUTE, at 0xc1
   \   union <unnamed> volatile __io _A_UCSR0B
   \                     _A_UCSR0B:
   \   00000000                      DS8 1

   \                                 In  segment ABSOLUTE, at 0xc0
   \   union <unnamed> volatile __io _A_UCSR0A
   \                     _A_UCSR0A:
   \   00000000                      DS8 1

   \                                 In  segment ABSOLUTE, at 0x2e
   \   union <unnamed> volatile __io _A_PORTE
   \                     _A_PORTE:
   \   00000000                      DS8 1
     10          #include "stdio.h"
     11          #include "math.h"
     12          #include "externals.h"
     13          #include "version.h"
     14          
     15          #if (OS_UART != 0)
     16          
     17          // USART0
     18          #pragma vector=USART0_RX_vect

   \                                 In  segment CODE, align 2, keep-with-next
     19          __interrupt void IntHandler_RX_USART0( void ){   
   \                     IntHandler_RX_USART0:
   \   00000000   939A               ST      -Y, R25
   \   00000002   938A               ST      -Y, R24
   \   00000004   93FA               ST      -Y, R31
   \   00000006   93EA               ST      -Y, R30
   \   00000008   923A               ST      -Y, R3
   \   0000000A   922A               ST      -Y, R2
   \   0000000C   921A               ST      -Y, R1
   \   0000000E   920A               ST      -Y, R0
   \   00000010   937A               ST      -Y, R23
   \   00000012   936A               ST      -Y, R22
   \   00000014   935A               ST      -Y, R21
   \   00000016   934A               ST      -Y, R20
   \   00000018   933A               ST      -Y, R19
   \   0000001A   932A               ST      -Y, R18
   \   0000001C   931A               ST      -Y, R17
   \   0000001E   930A               ST      -Y, R16
   \   00000020   B78F               IN      R24, 0x3F
   \   00000022   B79B               IN      R25, 0x3B
   \   00000024   9721               SBIW    R29:R28, 1
     20          
     21              OS_EnterInterrupt();
   \   00000026   9100....           LDS     R16, OS_InInt
   \   0000002A   9503               INC     R16
   \   0000002C   9300....           STS     OS_InInt, R16
   \   00000030   9100....           LDS     R16, OS_Counters
   \   00000034   9503               INC     R16
   \   00000036   9300....           STS     OS_Counters, R16
   \   0000003A   9100....           LDS     R16, (OS_Counters + 1)
   \   0000003E   9503               INC     R16
   \   00000040   9300....           STS     (OS_Counters + 1), R16
     22              OS_EnterIntStack();
   \   00000044   94F8               CLI
   \   00000046   ........           CALL    OS__EnterIntStack
   \   0000004A   9100....           LDS     R16, (OS_Counters + 1)
   \   0000004E   7F00               ANDI    R16, 0xF0
   \   00000050   2300               TST     R16
   \   00000052   F021               BREQ    ??IntHandler_RX_USART0_0
   \   00000054   E909               LDI     R16, 153
   \   00000056   E010               LDI     R17, 0
   \   00000058   ........           CALL    OS_Error
   \                     ??IntHandler_RX_USART0_0:
   \   0000005C   9100....           LDS     R16, (OS_Counters + 1)
   \   00000060   2300               TST     R16
   \   00000062   F409               BRNE    ??IntHandler_RX_USART0_1
   \   00000064   9478               SEI
     23              if ( UCSR0A & __BIT_MASK( DOR0 ) ) {                // Overrun error? 
   \                     ??IntHandler_RX_USART0_1:
   \   00000066   9100....           LDS     R16, _A_UCSR0A
     24              }
     25          
     26              if ( UCSR0A & __BIT_MASK( FE0 ) ) {                 // Framing error? 
   \   0000006A   9110....           LDS     R17, _A_UCSR0A
     27              }
     28          
     29              while ( UCSR0A & __BIT_MASK( RXC0)  ) {                // New byte avaiable?
   \                     ??IntHandler_RX_USART0_2:
   \   0000006E   9100....           LDS     R16, _A_UCSR0A
   \   00000072   2F10               MOV     R17, R16
   \   00000074   FF17               SBRS    R17, 7
   \   00000076   C009               RJMP    ??IntHandler_RX_USART0_3
     30          		char Data = UDR0;
   \   00000078   9100....           LDS     R16, _A_UDR0
   \   0000007C   8308               ST      Y, R16
     31          		OS_PutMailCond1(&UART[0].RxMailBox,&Data);
   \   0000007E   019E               MOVW    R19:R18, R29:R28
   \   00000080   ....               LDI     R16, LOW((UART + 12))
   \   00000082   ....               LDI     R17, HIGH((UART + 12))
   \   00000084   ........           CALL    OS_PutMailCond1
   \   00000088   CFF2               RJMP    ??IntHandler_RX_USART0_2
     32              }
     33              OS_LeaveIntStack();
   \                     ??IntHandler_RX_USART0_3:
   \   0000008A   94F8               CLI
   \   0000008C   ........           CALL    OS__LeaveIntStack
     34              OS_LeaveInterruptNoSwitch();
   \   00000090   9100....           LDS     R16, OS_InInt
   \   00000094   2F10               MOV     R17, R16
   \   00000096   951A               DEC     R17
   \   00000098   9310....           STS     OS_InInt, R17
   \   0000009C   2300               TST     R16
   \   0000009E   F421               BRNE    ??IntHandler_RX_USART0_4
   \   000000A0   E908               LDI     R16, 152
   \   000000A2   E010               LDI     R17, 0
   \   000000A4   ........           CALL    OS_Error
   \                     ??IntHandler_RX_USART0_4:
   \   000000A8   9100....           LDS     R16, (OS_Counters + 1)
   \   000000AC   950A               DEC     R16
   \   000000AE   9300....           STS     (OS_Counters + 1), R16
   \   000000B2   9100....           LDS     R16, OS_Counters
   \   000000B6   950A               DEC     R16
   \   000000B8   9300....           STS     OS_Counters, R16
     35          } 
   \   000000BC   9621               ADIW    R29:R28, 1
   \   000000BE   BF9B               OUT     0x3B, R25
   \   000000C0   BF8F               OUT     0x3F, R24
   \   000000C2   9109               LD      R16, Y+
   \   000000C4   9119               LD      R17, Y+
   \   000000C6   9129               LD      R18, Y+
   \   000000C8   9139               LD      R19, Y+
   \   000000CA   9149               LD      R20, Y+
   \   000000CC   9159               LD      R21, Y+
   \   000000CE   9169               LD      R22, Y+
   \   000000D0   9179               LD      R23, Y+
   \   000000D2   9009               LD      R0, Y+
   \   000000D4   9019               LD      R1, Y+
   \   000000D6   9029               LD      R2, Y+
   \   000000D8   9039               LD      R3, Y+
   \   000000DA   91E9               LD      R30, Y+
   \   000000DC   91F9               LD      R31, Y+
   \   000000DE   9189               LD      R24, Y+
   \   000000E0   9199               LD      R25, Y+
   \   000000E2   9518               RETI
   \   000000E4                      REQUIRE _A_UCSR0A
   \   000000E4                      REQUIRE _A_UDR0
     36          
     37          
     38          #pragma vector=USART0_TX_vect

   \                                 In  segment CODE, align 2, keep-with-next
     39          __interrupt void IntHandler_TX_USART0( void ){   
   \                     IntHandler_TX_USART0:
   \   00000000   939A               ST      -Y, R25
   \   00000002   938A               ST      -Y, R24
   \   00000004   93FA               ST      -Y, R31
   \   00000006   93EA               ST      -Y, R30
   \   00000008   923A               ST      -Y, R3
   \   0000000A   922A               ST      -Y, R2
   \   0000000C   921A               ST      -Y, R1
   \   0000000E   920A               ST      -Y, R0
   \   00000010   937A               ST      -Y, R23
   \   00000012   936A               ST      -Y, R22
   \   00000014   935A               ST      -Y, R21
   \   00000016   934A               ST      -Y, R20
   \   00000018   933A               ST      -Y, R19
   \   0000001A   932A               ST      -Y, R18
   \   0000001C   931A               ST      -Y, R17
   \   0000001E   930A               ST      -Y, R16
   \   00000020   B78F               IN      R24, 0x3F
   \   00000022   B79B               IN      R25, 0x3B
     40          
     41             OS_EnterInterrupt();
   \   00000024   9100....           LDS     R16, OS_InInt
   \   00000028   9503               INC     R16
   \   0000002A   9300....           STS     OS_InInt, R16
   \   0000002E   9100....           LDS     R16, OS_Counters
   \   00000032   9503               INC     R16
   \   00000034   9300....           STS     OS_Counters, R16
   \   00000038   9100....           LDS     R16, (OS_Counters + 1)
   \   0000003C   9503               INC     R16
   \   0000003E   9300....           STS     (OS_Counters + 1), R16
     42             OS_EnterIntStack();
   \   00000042   94F8               CLI
   \   00000044   ........           CALL    OS__EnterIntStack
   \   00000048   9100....           LDS     R16, (OS_Counters + 1)
   \   0000004C   7F00               ANDI    R16, 0xF0
   \   0000004E   2300               TST     R16
   \   00000050   F021               BREQ    ??IntHandler_TX_USART0_0
   \   00000052   E909               LDI     R16, 153
   \   00000054   E010               LDI     R17, 0
   \   00000056   ........           CALL    OS_Error
   \                     ??IntHandler_TX_USART0_0:
   \   0000005A   9100....           LDS     R16, (OS_Counters + 1)
   \   0000005E   2300               TST     R16
   \   00000060   F409               BRNE    ??IntHandler_TX_USART0_1
   \   00000062   9478               SEI
     43              
     44              UCSR0B &= ~(__BIT_MASK( TXCIE0)) ;            // transmission end, disable int.
   \                     ??IntHandler_TX_USART0_1:
   \   00000064   910000C1           LDS     R16, 193
   \   00000068   7B0F               ANDI    R16, 0xBF
   \   0000006A   930000C1           STS     193, R16
     45              PORTE &= ~0x04 ;                              // TXE0 off
   \   0000006E   9872               CBI     0x0E, 0x02
     46              OS_StopTimer(&TimerUSART0);                    // and stop timer
   \   00000070   ....               LDI     R16, LOW(TimerUSART0)
   \   00000072   ....               LDI     R17, (TimerUSART0) >> 8
   \   00000074   ........           CALL    OS_StopTimer
     47              GoToSyncUART(0) ;                                    // go to sync modus for recive
   \   00000078   E000               LDI     R16, 0
   \   0000007A   ........           CALL    GoToSyncUART
     48              
     49              OS_LeaveIntStack();
   \   0000007E   94F8               CLI
   \   00000080   ........           CALL    OS__LeaveIntStack
     50              OS_LeaveInterruptNoSwitch();
   \   00000084   9100....           LDS     R16, OS_InInt
   \   00000088   2F10               MOV     R17, R16
   \   0000008A   951A               DEC     R17
   \   0000008C   9310....           STS     OS_InInt, R17
   \   00000090   2300               TST     R16
   \   00000092   F421               BRNE    ??IntHandler_TX_USART0_2
   \   00000094   E908               LDI     R16, 152
   \   00000096   E010               LDI     R17, 0
   \   00000098   ........           CALL    OS_Error
   \                     ??IntHandler_TX_USART0_2:
   \   0000009C   9100....           LDS     R16, (OS_Counters + 1)
   \   000000A0   950A               DEC     R16
   \   000000A2   9300....           STS     (OS_Counters + 1), R16
   \   000000A6   9100....           LDS     R16, OS_Counters
   \   000000AA   950A               DEC     R16
   \   000000AC   9300....           STS     OS_Counters, R16
     51          }
   \   000000B0   BF9B               OUT     0x3B, R25
   \   000000B2   BF8F               OUT     0x3F, R24
   \   000000B4   9109               LD      R16, Y+
   \   000000B6   9119               LD      R17, Y+
   \   000000B8   9129               LD      R18, Y+
   \   000000BA   9139               LD      R19, Y+
   \   000000BC   9149               LD      R20, Y+
   \   000000BE   9159               LD      R21, Y+
   \   000000C0   9169               LD      R22, Y+
   \   000000C2   9179               LD      R23, Y+
   \   000000C4   9009               LD      R0, Y+
   \   000000C6   9019               LD      R1, Y+
   \   000000C8   9029               LD      R2, Y+
   \   000000CA   9039               LD      R3, Y+
   \   000000CC   91E9               LD      R30, Y+
   \   000000CE   91F9               LD      R31, Y+
   \   000000D0   9189               LD      R24, Y+
   \   000000D2   9199               LD      R25, Y+
   \   000000D4   9518               RETI
   \   000000D6                      REQUIRE _A_UCSR0B
   \   000000D6                      REQUIRE _A_PORTE
     52          
     53          
     54          #pragma vector = USART0_UDRE_vect

   \                                 In  segment CODE, align 2, keep-with-next
     55          __interrupt void IntHandler_UDRE_USART0( void ){   
   \                     IntHandler_UDRE_USART0:
   \   00000000   939A               ST      -Y, R25
   \   00000002   938A               ST      -Y, R24
   \   00000004   93FA               ST      -Y, R31
   \   00000006   93EA               ST      -Y, R30
   \   00000008   923A               ST      -Y, R3
   \   0000000A   922A               ST      -Y, R2
   \   0000000C   921A               ST      -Y, R1
   \   0000000E   920A               ST      -Y, R0
   \   00000010   937A               ST      -Y, R23
   \   00000012   936A               ST      -Y, R22
   \   00000014   935A               ST      -Y, R21
   \   00000016   934A               ST      -Y, R20
   \   00000018   933A               ST      -Y, R19
   \   0000001A   932A               ST      -Y, R18
   \   0000001C   931A               ST      -Y, R17
   \   0000001E   930A               ST      -Y, R16
   \   00000020   B78F               IN      R24, 0x3F
   \   00000022   B79B               IN      R25, 0x3B
     56          
     57              OS_EnterInterrupt();
   \   00000024   9100....           LDS     R16, OS_InInt
   \   00000028   9503               INC     R16
   \   0000002A   9300....           STS     OS_InInt, R16
   \   0000002E   9100....           LDS     R16, OS_Counters
   \   00000032   9503               INC     R16
   \   00000034   9300....           STS     OS_Counters, R16
   \   00000038   9100....           LDS     R16, (OS_Counters + 1)
   \   0000003C   9503               INC     R16
   \   0000003E   9300....           STS     (OS_Counters + 1), R16
     58              OS_EnterIntStack();
   \   00000042   94F8               CLI
   \   00000044   ........           CALL    OS__EnterIntStack
   \   00000048   9100....           LDS     R16, (OS_Counters + 1)
   \   0000004C   7F00               ANDI    R16, 0xF0
   \   0000004E   2300               TST     R16
   \   00000050   F021               BREQ    ??IntHandler_UDRE_USART0_0
   \   00000052   E909               LDI     R16, 153
   \   00000054   E010               LDI     R17, 0
   \   00000056   ........           CALL    OS_Error
   \                     ??IntHandler_UDRE_USART0_0:
   \   0000005A   9100....           LDS     R16, (OS_Counters + 1)
   \   0000005E   2300               TST     R16
   \   00000060   F409               BRNE    ??IntHandler_UDRE_USART0_1
   \   00000062   9478               SEI
     59              if ( UART[0].TxLast < UART[0].TxCount ) {
   \                     ??IntHandler_UDRE_USART0_1:
   \   00000064   9100....           LDS     R16, (UART + 4)
   \   00000068   9110....           LDS     R17, (UART + 5)
   \   0000006C   9120....           LDS     R18, (UART + 6)
   \   00000070   9130....           LDS     R19, (UART + 7)
   \   00000074   1702               CP      R16, R18
   \   00000076   0713               CPC     R17, R19
   \   00000078   F4B0               BRCC    ??IntHandler_UDRE_USART0_2
     60                  UDR0 = UART[0].pTxBuffer[ UART[0].TxLast ];     // Send a character
   \   0000007A   9100....           LDS     R16, (UART + 4)
   \   0000007E   9110....           LDS     R17, (UART + 5)
   \   00000082   91E0....           LDS     R30, UART
   \   00000086   91F0....           LDS     R31, (UART + 1)
   \   0000008A   0FE0               ADD     R30, R16
   \   0000008C   1FF1               ADC     R31, R17
   \   0000008E   8100               LD      R16, Z
   \   00000090   9300....           STS     _A_UDR0, R16
     61                  UART[0].TxLast++;
   \   00000094   ....               LDI     R30, LOW(UART)
   \   00000096   ....               LDI     R31, (UART) >> 8
   \   00000098   8104               LDD     R16, Z+4
   \   0000009A   8115               LDD     R17, Z+5
   \   0000009C   5F0F               SUBI    R16, 255
   \   0000009E   4F1F               SBCI    R17, 255
   \   000000A0   8304               STD     Z+4, R16
   \   000000A2   8315               STD     Z+5, R17
   \   000000A4   C00F               RJMP    ??IntHandler_UDRE_USART0_3
     62              } else{                                             // Last byte sent?
     63                    UCSR0B &= ~(__BIT_MASK( UDRIE0)) ;            // transmission end, disable int.
   \                     ??IntHandler_UDRE_USART0_2:
   \   000000A6   910000C1           LDS     R16, 193
   \   000000AA   7D0F               ANDI    R16, 0xDF
   \   000000AC   930000C1           STS     193, R16
     64                    UCSR0A |= (__BIT_MASK( TXC0)) ;               // Clear int bit in TXC.
   \   000000B0   910000C0           LDS     R16, 192
   \   000000B4   6400               ORI     R16, 0x40
   \   000000B6   930000C0           STS     192, R16
     65                    UCSR0B |= __BIT_MASK( TXCIE0) ;               // Enable TXC int.
   \   000000BA   910000C1           LDS     R16, 193
   \   000000BE   6400               ORI     R16, 0x40
   \   000000C0   930000C1           STS     193, R16
     66              }           
     67              OS_LeaveIntStack();
   \                     ??IntHandler_UDRE_USART0_3:
   \   000000C4   94F8               CLI
   \   000000C6   ........           CALL    OS__LeaveIntStack
     68              OS_LeaveInterruptNoSwitch();
   \   000000CA   9100....           LDS     R16, OS_InInt
   \   000000CE   2F10               MOV     R17, R16
   \   000000D0   951A               DEC     R17
   \   000000D2   9310....           STS     OS_InInt, R17
   \   000000D6   2300               TST     R16
   \   000000D8   F421               BRNE    ??IntHandler_UDRE_USART0_4
   \   000000DA   E908               LDI     R16, 152
   \   000000DC   E010               LDI     R17, 0
   \   000000DE   ........           CALL    OS_Error
   \                     ??IntHandler_UDRE_USART0_4:
   \   000000E2   9100....           LDS     R16, (OS_Counters + 1)
   \   000000E6   950A               DEC     R16
   \   000000E8   9300....           STS     (OS_Counters + 1), R16
   \   000000EC   9100....           LDS     R16, OS_Counters
   \   000000F0   950A               DEC     R16
   \   000000F2   9300....           STS     OS_Counters, R16
     69          } 
   \   000000F6   BF9B               OUT     0x3B, R25
   \   000000F8   BF8F               OUT     0x3F, R24
   \   000000FA   9109               LD      R16, Y+
   \   000000FC   9119               LD      R17, Y+
   \   000000FE   9129               LD      R18, Y+
   \   00000100   9139               LD      R19, Y+
   \   00000102   9149               LD      R20, Y+
   \   00000104   9159               LD      R21, Y+
   \   00000106   9169               LD      R22, Y+
   \   00000108   9179               LD      R23, Y+
   \   0000010A   9009               LD      R0, Y+
   \   0000010C   9019               LD      R1, Y+
   \   0000010E   9029               LD      R2, Y+
   \   00000110   9039               LD      R3, Y+
   \   00000112   91E9               LD      R30, Y+
   \   00000114   91F9               LD      R31, Y+
   \   00000116   9189               LD      R24, Y+
   \   00000118   9199               LD      R25, Y+
   \   0000011A   9518               RETI
   \   0000011C                      REQUIRE _A_UDR0
   \   0000011C                      REQUIRE _A_UCSR0B
   \   0000011C                      REQUIRE _A_UCSR0A

   \                                 In  segment INTVEC, offset 0x64, root
   \                     `??IntHandler_RX_USART0::??INTVEC 100`:
   \   00000064   ........           JMP     IntHandler_RX_USART0

   \                                 In  segment INTVEC, offset 0x68, root
   \                     `??IntHandler_UDRE_USART0::??INTVEC 104`:
   \   00000068   ........           JMP     IntHandler_UDRE_USART0

   \                                 In  segment INTVEC, offset 0x6c, root
   \                     `??IntHandler_TX_USART0::??INTVEC 108`:
   \   0000006C   ........           JMP     IntHandler_TX_USART0
     70          #endif
     71          

   Maximum stack usage in bytes:

   CSTACK RSTACK Function
   ------ ------ --------
     17      2   IntHandler_RX_USART0
       17      2   -> OS_Error
       17      2   -> OS_PutMailCond1
       17      2   -> OS__EnterIntStack
       17      2   -> OS__LeaveIntStack
     16      2   IntHandler_TX_USART0
       16      2   -> GoToSyncUART
       16      2   -> OS_Error
       16      2   -> OS_StopTimer
       16      2   -> OS__EnterIntStack
       16      2   -> OS__LeaveIntStack
     16      2   IntHandler_UDRE_USART0
       16      2   -> OS_Error
       16      2   -> OS__EnterIntStack
       16      2   -> OS__LeaveIntStack


   Segment part sizes:

   Bytes  Function/Label
   -----  --------------
     228  IntHandler_RX_USART0
       4  IntHandler_RX_USART0::??INTVEC 100
     214  IntHandler_TX_USART0
       4  IntHandler_TX_USART0::??INTVEC 108
     284  IntHandler_UDRE_USART0
       4  IntHandler_UDRE_USART0::??INTVEC 104
       1  _A_PORTE
       1  _A_UCSR0A
       1  _A_UCSR0B
       1  _A_UDR0

 
   4 bytes in segment ABSOLUTE
 726 bytes in segment CODE
  12 bytes in segment INTVEC
 
 726 bytes of CODE memory (+ 12 bytes shared)
   0 bytes of DATA memory (+  4 bytes shared)

Errors: none
Warnings: none
