###############################################################################
#
# IAR C/C++ Compiler V7.10.1.1197 for Atmel AVR           28/Sep/2017  10:44:04
# Copyright 1996-2017 IAR Systems AB.
# Startup license - IAR Embedded Workbench for Atmel AVR 7.10
#
#    Source file  =  D:\S2Prog\IO\ANZB\Src\adc.c
#    Command line =  
#        -f C:\Users\esy\AppData\Local\Temp\EWDE5.tmp
#        (D:\S2Prog\IO\ANZB\Src\adc.c --cpu=m128 -ms -o
#        D:\S2Prog\IO\ANZB\Debug\Obj -D OS_LIBMODE_D -D OS_UART=-1 -lCN
#        D:\S2Prog\IO\ANZB\Debug\List -y --initializers_in_flash --no_tbaa
#        --debug -DENABLE_BIT_DEFINITIONS -e -I D:\S2Prog\IO\ANZB\INC\ -I
#        D:\S2Prog\IO\ANZB\..\..\SHARED\INC\ --eeprom_size 4096 --clib -Ohz)
#    Locale       =  Norwegian Bokmål_NOR.1252
#    List file    =  D:\S2Prog\IO\ANZB\Debug\List\adc.lst
#    Object file  =  D:\S2Prog\IO\ANZB\Debug\Obj\adc.r90
#
###############################################################################

D:\S2Prog\IO\ANZB\Src\adc.c
      1          /****************************************************************************************
      2          / AD converter functions and interrupt
      3          /
      4          ***************************************************************************************/
      5          
      6          #include "iom128.h"

   \                                 In  segment ABSOLUTE, at 0x24
   \   union <unnamed> volatile __io _A_ADC
   \                     _A_ADC:
   \   00000000                      DS8 2

   \                                 In  segment ABSOLUTE, at 0x26
   \   union <unnamed> volatile __io _A_ADCSR
   \                     _A_ADCSR:
   \   00000000                      DS8 1

   \                                 In  segment ABSOLUTE, at 0x27
   \   union <unnamed> volatile __io _A_ADMUX
   \                     _A_ADMUX:
   \   00000000                      DS8 1
      7          #include "stdio.h"
      8          #include "math.h"
      9          #include "externals.h"
     10          #include "version.h"
     11          
     12          #pragma vector=ADC_vect

   \                                 In  segment CODE, align 2, keep-with-next
     13          __interrupt void IntHandler_AD( void ){
   \                     IntHandler_AD:
   \   00000000   939A               ST      -Y, R25
   \   00000002   938A               ST      -Y, R24
   \   00000004   93FA               ST      -Y, R31
   \   00000006   93EA               ST      -Y, R30
   \   00000008   923A               ST      -Y, R3
   \   0000000A   922A               ST      -Y, R2
   \   0000000C   921A               ST      -Y, R1
   \   0000000E   920A               ST      -Y, R0
   \   00000010   937A               ST      -Y, R23
   \   00000012   936A               ST      -Y, R22
   \   00000014   935A               ST      -Y, R21
   \   00000016   934A               ST      -Y, R20
   \   00000018   933A               ST      -Y, R19
   \   0000001A   932A               ST      -Y, R18
   \   0000001C   931A               ST      -Y, R17
   \   0000001E   930A               ST      -Y, R16
   \   00000020   B78F               IN      R24, 0x3F
   \   00000022   B79B               IN      R25, 0x3B
     14          
     15              OS_EnterInterrupt();
   \   00000024   9100....           LDS     R16, OS_InInt
   \   00000028   9503               INC     R16
   \   0000002A   9300....           STS     OS_InInt, R16
   \   0000002E   9100....           LDS     R16, OS_Counters
   \   00000032   9503               INC     R16
   \   00000034   9300....           STS     OS_Counters, R16
   \   00000038   ....               RCALL   ?Subroutine0
   \                     ??CrossCallReturnLabel_0:
   \   0000003A   9503               INC     R16
   \   0000003C   9300....           STS     (OS_Counters + 1), R16
     16              OS_EnterIntStack();
   \   00000040   94F8               CLI
   \   00000042   ........           CALL    OS__EnterIntStack
   \   00000046   ....               RCALL   ?Subroutine0
   \                     ??CrossCallReturnLabel_1:
   \   00000048   7F00               ANDI    R16, 0xF0
   \   0000004A   F011               BREQ    ??CrossCallReturnLabel_5
   \   0000004C   E909               LDI     R16, 153
   \   0000004E   ....               RCALL   ?Subroutine1
   \                     ??CrossCallReturnLabel_5:
   \   00000050   ....               RCALL   ?Subroutine0
   \                     ??CrossCallReturnLabel_2:
   \   00000052   2300               TST     R16
   \   00000054   F409               BRNE    ??IntHandler_AD_0
   \   00000056   9478               SEI
     17              ADInt.Result[ADChannel] = ADC; // Reading ADCL and ADCH in one run
   \                     ??IntHandler_AD_0:
   \   00000058   9100....           LDS     R16, ADChannel
   \   0000005C   B124               IN      R18, 0x04
   \   0000005E   B135               IN      R19, 0x05
   \   00000060   E012               LDI     R17, 2
   \   00000062   9F01               MUL     R16, R17
   \   00000064   01F0               MOVW    R31:R30, R1:R0
   \   00000066   ....               SUBI    R30, LOW((-(ADInt) & 0xFFFF))
   \   00000068   ....               SBCI    R31, (-(ADInt) & 0xFFFF) >> 8
   \   0000006A   8320               ST      Z, R18
   \   0000006C   8331               STD     Z+1, R19
     18              if (++ADChannel > 0x01 ) {                //set next ADchannel
   \   0000006E   9100....           LDS     R16, ADChannel
   \   00000072   9503               INC     R16
   \   00000074   9300....           STS     ADChannel, R16
   \   00000078   3002               CPI     R16, 2
   \   0000007A   F018               BRCS    ??IntHandler_AD_1
     19                    ADChannel = 0x00 ;
   \   0000007C   E000               LDI     R16, 0
   \   0000007E   9300....           STS     ADChannel, R16
     20              }
     21              ADMUX &= 0xe0 ;                           // set the channel
   \                     ??IntHandler_AD_1:
   \   00000082   B107               IN      R16, 0x07
   \   00000084   7E00               ANDI    R16, 0xE0
   \   00000086   B907               OUT     0x07, R16
     22              ADMUX |= ADChannel ;
   \   00000088   9100....           LDS     R16, ADChannel
   \   0000008C   B117               IN      R17, 0x07
   \   0000008E   2B10               OR      R17, R16
   \   00000090   B917               OUT     0x07, R17
     23              ADCSR |= 0x40 ;                           //start new convertion
   \   00000092   9A36               SBI     0x06, 0x06
     24              OS_LeaveIntStack();
   \   00000094   94F8               CLI
   \   00000096   ........           CALL    OS__LeaveIntStack
     25              OS_LeaveInterruptNoSwitch();
   \   0000009A   9100....           LDS     R16, OS_InInt
   \   0000009E   2F10               MOV     R17, R16
   \   000000A0   951A               DEC     R17
   \   000000A2   9310....           STS     OS_InInt, R17
   \   000000A6   2300               TST     R16
   \   000000A8   F411               BRNE    ??CrossCallReturnLabel_4
   \   000000AA   E908               LDI     R16, 152
   \   000000AC   ....               RCALL   ?Subroutine1
   \                     ??CrossCallReturnLabel_4:
   \   000000AE   ....               RCALL   ?Subroutine0
   \                     ??CrossCallReturnLabel_3:
   \   000000B0   950A               DEC     R16
   \   000000B2   9300....           STS     (OS_Counters + 1), R16
   \   000000B6   9100....           LDS     R16, OS_Counters
   \   000000BA   950A               DEC     R16
   \   000000BC   9300....           STS     OS_Counters, R16
     26          }
   \   000000C0   BF9B               OUT     0x3B, R25
   \   000000C2   BF8F               OUT     0x3F, R24
   \   000000C4   9109               LD      R16, Y+
   \   000000C6   9119               LD      R17, Y+
   \   000000C8   9129               LD      R18, Y+
   \   000000CA   9139               LD      R19, Y+
   \   000000CC   9149               LD      R20, Y+
   \   000000CE   9159               LD      R21, Y+
   \   000000D0   9169               LD      R22, Y+
   \   000000D2   9179               LD      R23, Y+
   \   000000D4   9009               LD      R0, Y+
   \   000000D6   9019               LD      R1, Y+
   \   000000D8   9029               LD      R2, Y+
   \   000000DA   9039               LD      R3, Y+
   \   000000DC   91E9               LD      R30, Y+
   \   000000DE   91F9               LD      R31, Y+
   \   000000E0   9189               LD      R24, Y+
   \   000000E2   9199               LD      R25, Y+
   \   000000E4   9518               RETI
   \   000000E6                      REQUIRE _A_ADC
   \   000000E6                      REQUIRE _A_ADMUX
   \   000000E6                      REQUIRE _A_ADCSR

   \                                 In  segment CODE, align 2, keep-with-next
   \                     ?Subroutine1:
   \   00000000   E010               LDI     R17, 0
   \   00000002   ........           JMP     OS_Error

   \                                 In  segment CODE, align 2, keep-with-next
   \                     ?Subroutine0:
   \   00000000   9100....           LDS     R16, (OS_Counters + 1)
   \   00000004   9508               RET

   \                                 In  segment INTVEC, offset 0x54, root
   \                     `??IntHandler_AD::??INTVEC 84`:
   \   00000054   ........           JMP     IntHandler_AD

   Maximum stack usage in bytes:

   CSTACK RSTACK Function
   ------ ------ --------
     16      2   IntHandler_AD
       16      2   -> OS_Error
       16      2   -> OS__EnterIntStack
       16      2   -> OS__LeaveIntStack


   Segment part sizes:

   Bytes  Function/Label
   -----  --------------
       6  ?Subroutine0
       6  ?Subroutine1
     230  IntHandler_AD
       4  IntHandler_AD::??INTVEC 84
       2  _A_ADC
       1  _A_ADCSR
       1  _A_ADMUX

 
   4 bytes in segment ABSOLUTE
 242 bytes in segment CODE
   4 bytes in segment INTVEC
 
 242 bytes of CODE memory (+ 4 bytes shared)
   0 bytes of DATA memory (+ 4 bytes shared)

Errors: none
Warnings: 2
