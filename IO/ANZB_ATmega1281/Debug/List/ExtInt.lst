###############################################################################
#
# IAR C/C++ Compiler V7.30.5.1680 for Microchip AVR       21/Nov/2023  09:48:25
# Copyright 1996-2022 IAR Systems AB.
# Mobile license - IAR Embedded Workbench for Microchip AVR 8.10
#
#    Source file  =  
#        C:\Users\ESY\OneDrive -
#        Scanjet\Documents\GitHub\S2Prog\IO\ANZB_ATmega1281\Src\ExtInt.c
#    Command line =  
#        -f C:\Users\ESY\AppData\Local\Temp\EWAE21.tmp ("C:\Users\ESY\OneDrive
#        - Scanjet\Documents\GitHub\S2Prog\IO\ANZB_ATmega1281\Src\ExtInt.c"
#        --cpu=m1281 -ms -o "C:\Users\ESY\OneDrive -
#        Scanjet\Documents\GitHub\S2Prog\IO\ANZB_ATmega1281\Debug\Obj" -D
#        OS_LIBMODE_D -D OS_UART=-1 -D USE_16552_DRIVER_TASK=1 -D
#        USE_MODBUS_PROTOCOL=0 -D ANZBANA_V8=0 -D __ATMEGA_1281__ -lCN
#        "C:\Users\ESY\OneDrive -
#        Scanjet\Documents\GitHub\S2Prog\IO\ANZB_ATmega1281\Debug\List" -y
#        --initializers_in_flash --no_cse --no_inline --no_code_motion
#        --no_cross_call --no_clustering --no_tbaa --debug
#        -DENABLE_BIT_DEFINITIONS -e -I "C:\Users\ESY\OneDrive -
#        Scanjet\Documents\GitHub\S2Prog\IO\ANZB_ATmega1281\INC\\" -I
#        "C:\Users\ESY\OneDrive -
#        Scanjet\Documents\GitHub\S2Prog\IO\ANZB_ATmega1281\..\..\SHARED\INC\\"
#        --eeprom_size 4096 --clib -On)
#    Locale       =  English_USA.1252
#    List file    =  
#        C:\Users\ESY\OneDrive -
#        Scanjet\Documents\GitHub\S2Prog\IO\ANZB_ATmega1281\Debug\List\ExtInt.lst
#    Object file  =  
#        C:\Users\ESY\OneDrive -
#        Scanjet\Documents\GitHub\S2Prog\IO\ANZB_ATmega1281\Debug\Obj\ExtInt.r90
#
###############################################################################

C:\Users\ESY\OneDrive - Scanjet\Documents\GitHub\S2Prog\IO\ANZB_ATmega1281\Src\ExtInt.c
      1          /****************************************************************************************
      2          / AD converter handling , AD7715
      3          /
      4          ***************************************************************************************/
      5          
      6          #include "iom1281.h" 
      7          #include "stdio.h"
      8          #include "math.h"
      9          #include "externals.h"
     10          
     11          #if USE_16552_DRIVER_TASK == 1

   \                                 In  segment CODE, align 2, keep-with-next
     12          static void
     13          _16552_0_irq_handler(void)
   \                     _16552_0_irq_handler:
     14          {
   \   00000000   93BA               ST      -Y, R27
   \   00000002   93AA               ST      -Y, R26
     15            UART16552[0].TxStatus = (U0_IIR & 0x0f);          // reason for interrupt
   \   00000004   9100220A           LDS     R16, 8714
   \   00000008   700F               ANDI    R16, 0x0F
   \   0000000A   9300....           STS     (UART16552 + 8), R16
     16            do {
     17              switch (UART16552[0].TxStatus) {
   \                     ??_16552_0_irq_handler_0:
   \   0000000E   9100....           LDS     R16, (UART16552 + 8)
   \   00000012   5000               SUBI    R16, 0
   \   00000014   F409               BRNE    $+2+2
   \   00000016   C0C7               RJMP    ??_16552_0_irq_handler_1
   \   00000018   5002               SUBI    R16, 2
   \   0000001A   F051               BREQ    ??_16552_0_irq_handler_2
   \   0000001C   5002               SUBI    R16, 2
   \   0000001E   F409               BRNE    $+2+2
   \   00000020   C049               RJMP    ??_16552_0_irq_handler_3
   \   00000022   5002               SUBI    R16, 2
   \   00000024   F409               BRNE    $+2+2
   \   00000026   C0BC               RJMP    ??_16552_0_irq_handler_4
   \   00000028   5006               SUBI    R16, 6
   \   0000002A   F409               BRNE    $+2+2
   \   0000002C   C043               RJMP    ??_16552_0_irq_handler_3
   \   0000002E   C0BD               RJMP    ??_16552_0_irq_handler_5
     18              case 0x02 :             // transmit holding reg emty
     19                if (UART16552[0].TxCount == 0) {
   \                     ??_16552_0_irq_handler_2:
   \   00000030   ....               LDI     R30, LOW(UART16552)
   \   00000032   ....               LDI     R31, (UART16552) >> 8
   \   00000034   8106               LDD     R16, Z+6
   \   00000036   8117               LDD     R17, Z+7
   \   00000038   2B01               OR      R16, R17
   \   0000003A   F451               BRNE    ??_16552_0_irq_handler_6
     20                  U0_MCR &= ~RTS;        // set RTS off
   \   0000003C   E0EC               LDI     R30, LOW(8716)
   \   0000003E   E2F2               LDI     R31, (8716) >> 8
   \   00000040   8100               LD      R16, Z
   \   00000042   7F0D               ANDI    R16, 0xFD
   \   00000044   8300               ST      Z, R16
     21                  OS_StopTimer(&TimerUART0);                    // and stop timer
   \   00000046   ....               LDI     R16, LOW(TimerUART0)
   \   00000048   ....               LDI     R17, (TimerUART0) >> 8
   \   0000004A   ........           CALL    OS_StopTimer
   \   0000004E   C0AD               RJMP    ??_16552_0_irq_handler_5
     22                } else {
     23                  for (UART16552[0].TxSeqCnt = 0;( UART16552[0].TxSeqCnt < FIFO_TX_BUFSIZE ) && (UART16552[0].TxCount > 0 ); UART16552[0].TxSeqCnt++, --UART16552[0].TxCount) {
   \                     ??_16552_0_irq_handler_6:
   \   00000050   E000               LDI     R16, 0
   \   00000052   9300....           STS     (UART16552 + 9), R16
   \                     ??_16552_0_irq_handler_7:
   \   00000056   9100....           LDS     R16, (UART16552 + 9)
   \   0000005A   3100               CPI     R16, 16
   \   0000005C   F550               BRCC    ??_16552_0_irq_handler_8
   \   0000005E   ....               LDI     R30, LOW(UART16552)
   \   00000060   ....               LDI     R31, (UART16552) >> 8
   \   00000062   8106               LDD     R16, Z+6
   \   00000064   8117               LDD     R17, Z+7
   \   00000066   2B01               OR      R16, R17
   \   00000068   F121               BREQ    ??_16552_0_irq_handler_8
     24                    U0_THR = UART16552[0].pTxBuffer[UART16552[0].TxLast++];
   \   0000006A   ....               LDI     R30, LOW(UART16552)
   \   0000006C   ....               LDI     R31, (UART16552) >> 8
   \   0000006E   8104               LDD     R16, Z+4
   \   00000070   8115               LDD     R17, Z+5
   \   00000072   ....               LDI     R26, LOW(UART16552)
   \   00000074   ....               LDI     R27, (UART16552) >> 8
   \   00000076   91ED               LD      R30, X+
   \   00000078   91FC               LD      R31, X
   \   0000007A   9711               SBIW    R27:R26, 1
   \   0000007C   0FE0               ADD     R30, R16
   \   0000007E   1FF1               ADC     R31, R17
   \   00000080   8100               LD      R16, Z
   \   00000082   93002208           STS     8712, R16
   \   00000086   ....               LDI     R30, LOW(UART16552)
   \   00000088   ....               LDI     R31, (UART16552) >> 8
   \   0000008A   8104               LDD     R16, Z+4
   \   0000008C   8115               LDD     R17, Z+5
   \   0000008E   5F0F               SUBI    R16, 255
   \   00000090   4F1F               SBCI    R17, 255
   \   00000092   8304               STD     Z+4, R16
   \   00000094   8315               STD     Z+5, R17
     25                  }
   \   00000096   9100....           LDS     R16, (UART16552 + 9)
   \   0000009A   9503               INC     R16
   \   0000009C   9300....           STS     (UART16552 + 9), R16
   \   000000A0   ....               LDI     R30, LOW(UART16552)
   \   000000A2   ....               LDI     R31, (UART16552) >> 8
   \   000000A4   8106               LDD     R16, Z+6
   \   000000A6   8117               LDD     R17, Z+7
   \   000000A8   5001               SUBI    R16, 1
   \   000000AA   4010               SBCI    R17, 0
   \   000000AC   8306               STD     Z+6, R16
   \   000000AE   8317               STD     Z+7, R17
   \   000000B0   CFD2               RJMP    ??_16552_0_irq_handler_7
     26                }
     27                break;
   \                     ??_16552_0_irq_handler_8:
   \   000000B2   C07B               RJMP    ??_16552_0_irq_handler_5
     28              case 0x04 :             // Receive data available    
     29              case 0x0C :             // or caracter timeout (FIFO)
     30                while (U0_LSR & DATA_READY) {
   \                     ??_16552_0_irq_handler_3:
   \   000000B4   E0ED               LDI     R30, LOW(8717)
   \   000000B6   E2F2               LDI     R31, (8717) >> 8
   \   000000B8   8100               LD      R16, Z
   \   000000BA   FF00               SBRS    R16, 0
   \   000000BC   C076               RJMP    ??_16552_0_irq_handler_5
     31          
     32                  UART16552[0].pRxBuffer[ UART16552[0].RxFirst ] = U0_RBR;             // Read the character 
   \   000000BE   91002208           LDS     R16, 8712
   \   000000C2   ....               LDI     R26, LOW((UART16552 + 10))
   \   000000C4   ....               LDI     R27, HIGH((UART16552 + 10))
   \   000000C6   91ED               LD      R30, X+
   \   000000C8   91FC               LD      R31, X
   \   000000CA   9711               SBIW    R27:R26, 1
   \   000000CC   ....               LDI     R26, LOW((UART16552 + 12))
   \   000000CE   ....               LDI     R27, HIGH((UART16552 + 12))
   \   000000D0   912D               LD      R18, X+
   \   000000D2   913C               LD      R19, X
   \   000000D4   9711               SBIW    R27:R26, 1
   \   000000D6   0FE2               ADD     R30, R18
   \   000000D8   1FF3               ADC     R31, R19
   \   000000DA   8300               ST      Z, R16
     33          
     34                  if (UART16552[0].RxState != HANDLE) {                 // ok to receive? 
   \   000000DC   9100....           LDS     R16, (UART16552 + 18)
   \   000000E0   300A               CPI     R16, 10
   \   000000E2   F341               BREQ    ??_16552_0_irq_handler_3
     35                    switch (UART16552[0].RxState) {                   // Yes, check state
   \   000000E4   9100....           LDS     R16, (UART16552 + 18)
   \   000000E8   2300               TST     R16
   \   000000EA   F009               BREQ    $+2+2
   \   000000EC   C041               RJMP    ??_16552_0_irq_handler_9
     36                      case SYNC :
     37                        if ( UART16552[0].pRxBuffer[ UART16552[0].RxFirst ] == ANPRO1_SYN) {
   \   000000EE   ....               LDI     R26, LOW((UART16552 + 10))
   \   000000F0   ....               LDI     R27, HIGH((UART16552 + 10))
   \   000000F2   91ED               LD      R30, X+
   \   000000F4   91FC               LD      R31, X
   \   000000F6   9711               SBIW    R27:R26, 1
   \   000000F8   ....               LDI     R26, LOW((UART16552 + 12))
   \   000000FA   ....               LDI     R27, HIGH((UART16552 + 12))
   \   000000FC   910D               LD      R16, X+
   \   000000FE   911C               LD      R17, X
   \   00000100   9711               SBIW    R27:R26, 1
   \   00000102   0FE0               ADD     R30, R16
   \   00000104   1FF1               ADC     R31, R17
   \   00000106   8100               LD      R16, Z
   \   00000108   3002               CPI     R16, 2
   \   0000010A   F461               BRNE    ??_16552_0_irq_handler_10
     38                          UART16552[0].SyncCnt ++ ;                 // count sync
   \   0000010C   9100....           LDS     R16, (UART16552 + 19)
   \   00000110   9503               INC     R16
   \   00000112   9300....           STS     (UART16552 + 19), R16
     39                          UART16552[0].RxFirst = 0;                 // start at start of buff
   \   00000116   ....               LDI     R30, LOW(UART16552)
   \   00000118   ....               LDI     R31, (UART16552) >> 8
   \   0000011A   E000               LDI     R16, 0
   \   0000011C   8704               STD     Z+12, R16
   \   0000011E   E000               LDI     R16, 0
   \   00000120   8705               STD     Z+13, R16
   \   00000122   CFC8               RJMP    ??_16552_0_irq_handler_3
     40                        } else if (UART16552[0].SyncCnt >= 2) {       // minimum two sync bytes
   \                     ??_16552_0_irq_handler_10:
   \   00000124   9100....           LDS     R16, (UART16552 + 19)
   \   00000128   3002               CPI     R16, 2
   \   0000012A   F0F0               BRCS    ??_16552_0_irq_handler_11
     41                          UART16552[0].SyncCnt = 0 ;                // reset counter
   \   0000012C   E000               LDI     R16, 0
   \   0000012E   9300....           STS     (UART16552 + 19), R16
     42                          UART16552[0].RxState = HEADER ;
   \   00000132   E001               LDI     R16, 1
   \   00000134   9300....           STS     (UART16552 + 18), R16
     43                          UART16552[0].RxLast = 0 ;
   \   00000138   ....               LDI     R30, LOW(UART16552)
   \   0000013A   ....               LDI     R31, (UART16552) >> 8
   \   0000013C   E000               LDI     R16, 0
   \   0000013E   8706               STD     Z+14, R16
   \   00000140   E000               LDI     R16, 0
   \   00000142   8707               STD     Z+15, R16
     44                          UART16552[0].RxTimeout = RX_TO_TIME ;   // reset timeout
   \   00000144   ....               LDI     R30, LOW(UART16552)
   \   00000146   ....               LDI     R31, (UART16552) >> 8
   \   00000148   EF0A               LDI     R16, 250
   \   0000014A   E010               LDI     R17, 0
   \   0000014C   8B04               STD     Z+20, R16
   \   0000014E   8B15               STD     Z+21, R17
     45                          UART16552[0].RxFirst++ ;                 //  1. char OK, start on next
   \   00000150   ....               LDI     R30, LOW(UART16552)
   \   00000152   ....               LDI     R31, (UART16552) >> 8
   \   00000154   8504               LDD     R16, Z+12
   \   00000156   8515               LDD     R17, Z+13
   \   00000158   5F0F               SUBI    R16, 255
   \   0000015A   4F1F               SBCI    R17, 255
   \   0000015C   8704               STD     Z+12, R16
   \   0000015E   8715               STD     Z+13, R17
     46                          ReceivePacketUart16552(0) ;              // Check package
   \   00000160   E000               LDI     R16, 0
   \   00000162   ........           CALL    ReceivePacketUart16552
   \   00000166   CFA6               RJMP    ??_16552_0_irq_handler_3
     47                        } else {
     48                          UART16552[0].SyncCnt = 0 ;                // start over once more
   \                     ??_16552_0_irq_handler_11:
   \   00000168   E000               LDI     R16, 0
   \   0000016A   9300....           STS     (UART16552 + 19), R16
     49                        }
     50                        break;
   \   0000016E   CFA2               RJMP    ??_16552_0_irq_handler_3
     51                      default :
     52                        if ((++UART16552[0].RxFirst) > RXSIZE_UART_16552) { // Point to next location
   \                     ??_16552_0_irq_handler_9:
   \   00000170   ....               LDI     R30, LOW(UART16552)
   \   00000172   ....               LDI     R31, (UART16552) >> 8
   \   00000174   8504               LDD     R16, Z+12
   \   00000176   8515               LDD     R17, Z+13
   \   00000178   5F0F               SUBI    R16, 255
   \   0000017A   4F1F               SBCI    R17, 255
   \   0000017C   8704               STD     Z+12, R16
   \   0000017E   8715               STD     Z+13, R17
   \   00000180   ....               LDI     R30, LOW(UART16552)
   \   00000182   ....               LDI     R31, (UART16552) >> 8
   \   00000184   8504               LDD     R16, Z+12
   \   00000186   8515               LDD     R17, Z+13
   \   00000188   3709               CPI     R16, 121
   \   0000018A   E020               LDI     R18, 0
   \   0000018C   0712               CPC     R17, R18
   \   0000018E   F020               BRCS    ??_16552_0_irq_handler_12
     53                          GoToSyncUART16552(0) ;                       // go to sync mode
   \   00000190   E000               LDI     R16, 0
   \   00000192   ........           CALL    GoToSyncUART16552
   \   00000196   CF8E               RJMP    ??_16552_0_irq_handler_3
     54                        } else {
     55                          ReceivePacketUart16552(0) ;              // Check package
   \                     ??_16552_0_irq_handler_12:
   \   00000198   E000               LDI     R16, 0
   \   0000019A   ........           CALL    ReceivePacketUart16552
     56                        }
     57                        break ;   
   \   0000019E   CF8A               RJMP    ??_16552_0_irq_handler_3
     58                    }
     59                  }
     60                } 
     61                break;
     62              case 0x06 :                 // Receiver line status, OR, PE, FR, Break int.
     63                U0_LSR;      // Dummy read to empty register        
   \                     ??_16552_0_irq_handler_4:
   \   000001A0   9100220D           LDS     R16, 8717
     64                break;
   \   000001A4   C002               RJMP    ??_16552_0_irq_handler_5
     65              case 0x00 :                 // Modem status.
     66                U0_MSR;      // Dummy read to empty register           
   \                     ??_16552_0_irq_handler_1:
   \   000001A6   9100220E           LDS     R16, 8718
     67                break;
     68              }
     69              UART16552[0].TxStatus = (U0_IIR & 0x0f) ;      // reason for interrupt, 
   \                     ??_16552_0_irq_handler_5:
   \   000001AA   9100220A           LDS     R16, 8714
   \   000001AE   700F               ANDI    R16, 0x0F
   \   000001B0   9300....           STS     (UART16552 + 8), R16
     70              // check again before exit to avoid lost int. and hang
     71            } while ((UART16552[0].TxStatus & 0x01) != 0x01) ;  
   \   000001B4   ....               LDI     R30, LOW(UART16552)
   \   000001B6   ....               LDI     R31, (UART16552) >> 8
   \   000001B8   8500               LDD     R16, Z+8
   \   000001BA   FF00               SBRS    R16, 0
   \   000001BC   CF28               RJMP    ??_16552_0_irq_handler_0
     72          }
   \   000001BE   91A9               LD      R26, Y+
   \   000001C0   91B9               LD      R27, Y+
   \   000001C2   9508               RET
     73          

   \                                 In  segment CODE, align 2, keep-with-next
     74          static void
     75          _16552_1_irq_handler(void)
   \                     _16552_1_irq_handler:
     76          {
   \   00000000   93BA               ST      -Y, R27
   \   00000002   93AA               ST      -Y, R26
     77            UART16552[1].TxStatus = (U1_IIR & 0x0f) ;      // reason for interrupt
   \   00000004   91002202           LDS     R16, 8706
   \   00000008   700F               ANDI    R16, 0x0F
   \   0000000A   9300....           STS     (UART16552 + 34), R16
     78            do {
     79              switch (UART16552[1].TxStatus) {
   \                     ??_16552_1_irq_handler_0:
   \   0000000E   9100....           LDS     R16, (UART16552 + 34)
   \   00000012   5000               SUBI    R16, 0
   \   00000014   F409               BRNE    $+2+2
   \   00000016   C0C8               RJMP    ??_16552_1_irq_handler_1
   \   00000018   5002               SUBI    R16, 2
   \   0000001A   F051               BREQ    ??_16552_1_irq_handler_2
   \   0000001C   5002               SUBI    R16, 2
   \   0000001E   F409               BRNE    $+2+2
   \   00000020   C04A               RJMP    ??_16552_1_irq_handler_3
   \   00000022   5002               SUBI    R16, 2
   \   00000024   F409               BRNE    $+2+2
   \   00000026   C0BD               RJMP    ??_16552_1_irq_handler_4
   \   00000028   5006               SUBI    R16, 6
   \   0000002A   F409               BRNE    $+2+2
   \   0000002C   C044               RJMP    ??_16552_1_irq_handler_3
   \   0000002E   C0BE               RJMP    ??_16552_1_irq_handler_5
     80              case 0x02 :             // transmit holding reg emty
     81                if (UART16552[1].TxCount == 0) {
   \                     ??_16552_1_irq_handler_2:
   \   00000030   ....               LDI     R30, LOW(UART16552)
   \   00000032   ....               LDI     R31, (UART16552) >> 8
   \   00000034   A100               LDD     R16, Z+32
   \   00000036   A111               LDD     R17, Z+33
   \   00000038   2B01               OR      R16, R17
   \   0000003A   F451               BRNE    ??_16552_1_irq_handler_6
     82                  U1_MCR &= ~RTS;        // set RTS off
   \   0000003C   E0E4               LDI     R30, LOW(8708)
   \   0000003E   E2F2               LDI     R31, (8708) >> 8
   \   00000040   8100               LD      R16, Z
   \   00000042   7F0D               ANDI    R16, 0xFD
   \   00000044   8300               ST      Z, R16
     83                  OS_StopTimer(&TimerUART1);                    // and stop timer
   \   00000046   ....               LDI     R16, LOW(TimerUART1)
   \   00000048   ....               LDI     R17, (TimerUART1) >> 8
   \   0000004A   ........           CALL    OS_StopTimer
   \   0000004E   C0AE               RJMP    ??_16552_1_irq_handler_5
     84                } else {
     85                  for (UART16552[1].TxSeqCnt = 0;( UART16552[1].TxSeqCnt < FIFO_TX_BUFSIZE ) && (UART16552[1].TxCount > 0 ); UART16552[1].TxSeqCnt++, UART16552[1].TxCount--) {
   \                     ??_16552_1_irq_handler_6:
   \   00000050   E000               LDI     R16, 0
   \   00000052   9300....           STS     (UART16552 + 35), R16
   \                     ??_16552_1_irq_handler_7:
   \   00000056   9100....           LDS     R16, (UART16552 + 35)
   \   0000005A   3100               CPI     R16, 16
   \   0000005C   F558               BRCC    ??_16552_1_irq_handler_8
   \   0000005E   ....               LDI     R30, LOW(UART16552)
   \   00000060   ....               LDI     R31, (UART16552) >> 8
   \   00000062   A100               LDD     R16, Z+32
   \   00000064   A111               LDD     R17, Z+33
   \   00000066   2B01               OR      R16, R17
   \   00000068   F129               BREQ    ??_16552_1_irq_handler_8
     86                    U1_THR = UART16552[1].pTxBuffer[UART16552[1].TxLast++] ;
   \   0000006A   ....               LDI     R26, LOW((UART16552 + 26))
   \   0000006C   ....               LDI     R27, HIGH((UART16552 + 26))
   \   0000006E   91ED               LD      R30, X+
   \   00000070   91FC               LD      R31, X
   \   00000072   9711               SBIW    R27:R26, 1
   \   00000074   ....               LDI     R26, LOW((UART16552 + 30))
   \   00000076   ....               LDI     R27, HIGH((UART16552 + 30))
   \   00000078   910D               LD      R16, X+
   \   0000007A   911C               LD      R17, X
   \   0000007C   9711               SBIW    R27:R26, 1
   \   0000007E   0FE0               ADD     R30, R16
   \   00000080   1FF1               ADC     R31, R17
   \   00000082   8100               LD      R16, Z
   \   00000084   93002200           STS     8704, R16
   \   00000088   ....               LDI     R30, LOW(UART16552)
   \   0000008A   ....               LDI     R31, (UART16552) >> 8
   \   0000008C   8D06               LDD     R16, Z+30
   \   0000008E   8D17               LDD     R17, Z+31
   \   00000090   5F0F               SUBI    R16, 255
   \   00000092   4F1F               SBCI    R17, 255
   \   00000094   8F06               STD     Z+30, R16
   \   00000096   8F17               STD     Z+31, R17
     87                  }
   \   00000098   9100....           LDS     R16, (UART16552 + 35)
   \   0000009C   9503               INC     R16
   \   0000009E   9300....           STS     (UART16552 + 35), R16
   \   000000A2   ....               LDI     R30, LOW(UART16552)
   \   000000A4   ....               LDI     R31, (UART16552) >> 8
   \   000000A6   A100               LDD     R16, Z+32
   \   000000A8   A111               LDD     R17, Z+33
   \   000000AA   5001               SUBI    R16, 1
   \   000000AC   4010               SBCI    R17, 0
   \   000000AE   A300               STD     Z+32, R16
   \   000000B0   A311               STD     Z+33, R17
   \   000000B2   CFD1               RJMP    ??_16552_1_irq_handler_7
     88                }
     89                break;
   \                     ??_16552_1_irq_handler_8:
   \   000000B4   C07B               RJMP    ??_16552_1_irq_handler_5
     90              case 0x04 :             // Receive data available    
     91              case 0x0C :             // or caracter timeout (FIFO)
     92                while (U1_LSR & DATA_READY) {
   \                     ??_16552_1_irq_handler_3:
   \   000000B6   E0E5               LDI     R30, LOW(8709)
   \   000000B8   E2F2               LDI     R31, (8709) >> 8
   \   000000BA   8100               LD      R16, Z
   \   000000BC   FF00               SBRS    R16, 0
   \   000000BE   C076               RJMP    ??_16552_1_irq_handler_5
     93          
     94                  UART16552[1].pRxBuffer[ UART16552[1].RxFirst ] = U1_RBR;          // Read the character 
   \   000000C0   91002200           LDS     R16, 8704
   \   000000C4   ....               LDI     R26, LOW((UART16552 + 36))
   \   000000C6   ....               LDI     R27, HIGH((UART16552 + 36))
   \   000000C8   91ED               LD      R30, X+
   \   000000CA   91FC               LD      R31, X
   \   000000CC   9711               SBIW    R27:R26, 1
   \   000000CE   ....               LDI     R26, LOW((UART16552 + 38))
   \   000000D0   ....               LDI     R27, HIGH((UART16552 + 38))
   \   000000D2   912D               LD      R18, X+
   \   000000D4   913C               LD      R19, X
   \   000000D6   9711               SBIW    R27:R26, 1
   \   000000D8   0FE2               ADD     R30, R18
   \   000000DA   1FF3               ADC     R31, R19
   \   000000DC   8300               ST      Z, R16
     95          
     96                  if (UART16552[1].RxState != HANDLE) {        // ok to receive? 
   \   000000DE   9100....           LDS     R16, (UART16552 + 44)
   \   000000E2   300A               CPI     R16, 10
   \   000000E4   F341               BREQ    ??_16552_1_irq_handler_3
     97                    switch (UART16552[1].RxState) {                   // Yes, check state
   \   000000E6   9100....           LDS     R16, (UART16552 + 44)
   \   000000EA   2300               TST     R16
   \   000000EC   F009               BREQ    $+2+2
   \   000000EE   C041               RJMP    ??_16552_1_irq_handler_9
     98                      case SYNC :
     99                        if ( UART16552[1].pRxBuffer[ UART16552[1].RxFirst ] == ANPRO1_SYN) {
   \   000000F0   ....               LDI     R26, LOW((UART16552 + 36))
   \   000000F2   ....               LDI     R27, HIGH((UART16552 + 36))
   \   000000F4   91ED               LD      R30, X+
   \   000000F6   91FC               LD      R31, X
   \   000000F8   9711               SBIW    R27:R26, 1
   \   000000FA   ....               LDI     R26, LOW((UART16552 + 38))
   \   000000FC   ....               LDI     R27, HIGH((UART16552 + 38))
   \   000000FE   910D               LD      R16, X+
   \   00000100   911C               LD      R17, X
   \   00000102   9711               SBIW    R27:R26, 1
   \   00000104   0FE0               ADD     R30, R16
   \   00000106   1FF1               ADC     R31, R17
   \   00000108   8100               LD      R16, Z
   \   0000010A   3002               CPI     R16, 2
   \   0000010C   F461               BRNE    ??_16552_1_irq_handler_10
    100                          UART16552[1].SyncCnt ++ ;                 // count sync
   \   0000010E   9100....           LDS     R16, (UART16552 + 45)
   \   00000112   9503               INC     R16
   \   00000114   9300....           STS     (UART16552 + 45), R16
    101                          UART16552[1].RxFirst = 0;                 // start at start of buff
   \   00000118   ....               LDI     R30, LOW(UART16552)
   \   0000011A   ....               LDI     R31, (UART16552) >> 8
   \   0000011C   E000               LDI     R16, 0
   \   0000011E   A306               STD     Z+38, R16
   \   00000120   E000               LDI     R16, 0
   \   00000122   A307               STD     Z+39, R16
   \   00000124   CFC8               RJMP    ??_16552_1_irq_handler_3
    102                        } else if (UART16552[1].SyncCnt >= 2) {       // minimum two sync bytes
   \                     ??_16552_1_irq_handler_10:
   \   00000126   9100....           LDS     R16, (UART16552 + 45)
   \   0000012A   3002               CPI     R16, 2
   \   0000012C   F0F0               BRCS    ??_16552_1_irq_handler_11
    103                          UART16552[1].SyncCnt = 0 ;                // reset counter
   \   0000012E   E000               LDI     R16, 0
   \   00000130   9300....           STS     (UART16552 + 45), R16
    104                          UART16552[1].RxState = HEADER ;
   \   00000134   E001               LDI     R16, 1
   \   00000136   9300....           STS     (UART16552 + 44), R16
    105                          UART16552[1].RxLast = 0 ;
   \   0000013A   ....               LDI     R30, LOW(UART16552)
   \   0000013C   ....               LDI     R31, (UART16552) >> 8
   \   0000013E   E000               LDI     R16, 0
   \   00000140   A700               STD     Z+40, R16
   \   00000142   E000               LDI     R16, 0
   \   00000144   A701               STD     Z+41, R16
    106                          UART16552[1].RxTimeout = RX_TO_TIME ;     // reset timeout
   \   00000146   ....               LDI     R30, LOW(UART16552)
   \   00000148   ....               LDI     R31, (UART16552) >> 8
   \   0000014A   EF0A               LDI     R16, 250
   \   0000014C   E010               LDI     R17, 0
   \   0000014E   A706               STD     Z+46, R16
   \   00000150   A717               STD     Z+47, R17
    107                          UART16552[1].RxFirst++ ;                  //  1. char OK, start on next
   \   00000152   ....               LDI     R30, LOW(UART16552)
   \   00000154   ....               LDI     R31, (UART16552) >> 8
   \   00000156   A106               LDD     R16, Z+38
   \   00000158   A117               LDD     R17, Z+39
   \   0000015A   5F0F               SUBI    R16, 255
   \   0000015C   4F1F               SBCI    R17, 255
   \   0000015E   A306               STD     Z+38, R16
   \   00000160   A317               STD     Z+39, R17
    108                          ReceivePacketUart16552(1) ;               // Check package
   \   00000162   E001               LDI     R16, 1
   \   00000164   ........           CALL    ReceivePacketUart16552
   \   00000168   CFA6               RJMP    ??_16552_1_irq_handler_3
    109                        } else {
    110                          UART16552[1].SyncCnt = 0 ;                // start over once more
   \                     ??_16552_1_irq_handler_11:
   \   0000016A   E000               LDI     R16, 0
   \   0000016C   9300....           STS     (UART16552 + 45), R16
    111                        }
    112                        break;
   \   00000170   CFA2               RJMP    ??_16552_1_irq_handler_3
    113                      default :
    114                        if ((++UART16552[1].RxFirst) > RXSIZE_UART_16552) { // Point to next location
   \                     ??_16552_1_irq_handler_9:
   \   00000172   ....               LDI     R30, LOW(UART16552)
   \   00000174   ....               LDI     R31, (UART16552) >> 8
   \   00000176   A106               LDD     R16, Z+38
   \   00000178   A117               LDD     R17, Z+39
   \   0000017A   5F0F               SUBI    R16, 255
   \   0000017C   4F1F               SBCI    R17, 255
   \   0000017E   A306               STD     Z+38, R16
   \   00000180   A317               STD     Z+39, R17
   \   00000182   ....               LDI     R30, LOW(UART16552)
   \   00000184   ....               LDI     R31, (UART16552) >> 8
   \   00000186   A106               LDD     R16, Z+38
   \   00000188   A117               LDD     R17, Z+39
   \   0000018A   3709               CPI     R16, 121
   \   0000018C   E020               LDI     R18, 0
   \   0000018E   0712               CPC     R17, R18
   \   00000190   F020               BRCS    ??_16552_1_irq_handler_12
    115                          GoToSyncUART16552(1) ;                       // go to sync mode
   \   00000192   E001               LDI     R16, 1
   \   00000194   ........           CALL    GoToSyncUART16552
   \   00000198   CF8E               RJMP    ??_16552_1_irq_handler_3
    116                        } else {
    117                          ReceivePacketUart16552(1) ;              // Check package
   \                     ??_16552_1_irq_handler_12:
   \   0000019A   E001               LDI     R16, 1
   \   0000019C   ........           CALL    ReceivePacketUart16552
    118                        }
    119                        break ;   
   \   000001A0   CF8A               RJMP    ??_16552_1_irq_handler_3
    120                    }
    121                  }
    122                }
    123                break;
    124              case 0x06 :                 // Receiver line status, OR, PE, FR, Break int.
    125                U1_LSR;      // Dummy read to empty register        
   \                     ??_16552_1_irq_handler_4:
   \   000001A2   91002205           LDS     R16, 8709
    126                break;
   \   000001A6   C002               RJMP    ??_16552_1_irq_handler_5
    127              case 0x00 :                 // Modem status.
    128                U1_MSR;      // Dummy read to empty register           
   \                     ??_16552_1_irq_handler_1:
   \   000001A8   91002206           LDS     R16, 8710
    129                break;
    130              }
    131              UART16552[1].TxStatus = (U1_IIR & 0x0f) ;      // reason for interrupt, 
   \                     ??_16552_1_irq_handler_5:
   \   000001AC   91002202           LDS     R16, 8706
   \   000001B0   700F               ANDI    R16, 0x0F
   \   000001B2   9300....           STS     (UART16552 + 34), R16
    132              // check again before exit to avoid lost int. and hang
    133            } while ((UART16552[1].TxStatus & 0x01) != 0x01);  
   \   000001B6   ....               LDI     R30, LOW(UART16552)
   \   000001B8   ....               LDI     R31, (UART16552) >> 8
   \   000001BA   A102               LDD     R16, Z+34
   \   000001BC   FF00               SBRS    R16, 0
   \   000001BE   CF27               RJMP    ??_16552_1_irq_handler_0
    134          }
   \   000001C0   91A9               LD      R26, Y+
   \   000001C2   91B9               LD      R27, Y+
   \   000001C4   9508               RET
    135          

   \                                 In  segment CODE, align 2, keep-with-next
    136          static void
    137          _16552_driver_task(void)
   \                     _16552_driver_task:
    138          {
   \   00000000   938A               ST      -Y, R24
    139          
    140            while(1)
    141            {
    142              char status = OS_WaitEventTimed(0x01 | 0x02, 500);
   \                     ??_16552_driver_task_0:
   \   00000002   EF24               LDI     R18, 244
   \   00000004   E031               LDI     R19, 1
   \   00000006   E003               LDI     R16, 3
   \   00000008   ........           CALL    OS_WaitEventTimed
   \   0000000C   2F80               MOV     R24, R16
    143          
    144              if (status & 0x01)
   \   0000000E   FB80               BST     R24, 0
   \   00000010   F40E               BRTC    ??_16552_driver_task_1
    145              {
    146                _16552_0_irq_handler();
   \   00000012   ....               RCALL   _16552_0_irq_handler
    147              }
    148          
    149              if (status & 0x02)
   \                     ??_16552_driver_task_1:
   \   00000014   FB81               BST     R24, 1
   \   00000016   F7AE               BRTC    ??_16552_driver_task_0
    150              {
    151                _16552_1_irq_handler();
   \   00000018   ....               RCALL   _16552_1_irq_handler
   \   0000001A   CFF3               RJMP    ??_16552_driver_task_0
    152              }
    153            }
    154          }
    155          

   \                                 In  segment NEAR_Z, align 1, keep-with-next
   \   00000000                      REQUIRE `?<Segment init: NEAR_Z>`
    156          static OS_TASK TCB_16552_DRIVER;
   \                     TCB_16552_DRIVER:
   \   00000000                      DS8 33

   \                                 In  segment NEAR_Z, align 1, keep-with-next
   \   00000000                      REQUIRE `?<Segment init: NEAR_Z>`
    157          static OS_STACKPTR int stack[150]; /* Task stacks */
   \                     stack:
   \   00000000                      DS8 300
    158          

   \                                 In  segment CODE, align 2, keep-with-next
    159          void
    160          _16552_driver_task_init(void)
   \                     _16552_driver_task_init:
    161          {
    162          
    163            OS_CREATETASK(&TCB_16552_DRIVER, "16552_DRIVER", _16552_driver_task, 90, stack);
   \   00000000   E002               LDI     R16, 2
   \   00000002   E010               LDI     R17, 0
   \   00000004   931A               ST      -Y, R17
   \   00000006   930A               ST      -Y, R16
   \   00000008   E20C               LDI     R16, 44
   \   0000000A   E011               LDI     R17, 1
   \   0000000C   931A               ST      -Y, R17
   \   0000000E   930A               ST      -Y, R16
   \   00000010   ....               LDI     R16, LOW(stack)
   \   00000012   ....               LDI     R17, (stack) >> 8
   \   00000014   931A               ST      -Y, R17
   \   00000016   930A               ST      -Y, R16
   \   00000018   ....               LDI     R22, LOW(_16552_driver_task/2)
   \   0000001A   ....               LDI     R23, (_16552_driver_task/2) >> 8
   \   0000001C   E54A               LDI     R20, 90
   \   0000001E   ....               LDI     R18, LOW(`?<Constant "16552_DRIVER">`)
   \   00000020   ....               LDI     R19, (`?<Constant "16552_DRIVER">`) >> 8
   \   00000022   ....               LDI     R16, LOW(TCB_16552_DRIVER)
   \   00000024   ....               LDI     R17, (TCB_16552_DRIVER) >> 8
   \   00000026   ........           CALL    OS_CreateTask_D
    164          }
   \   0000002A   9508               RET
    165          #endif
    166          
    167          /*************************************************************************
    168          *
    169          *  External int 0 (UART PC16554 on AN-ZB485 or ADready on AN-ZBANA)
    170          *
    171          *************************************************************************/

   \                                 In  segment CODE, align 2, keep-with-next
    172           void Int_Handler_INT0( void ){               //Int handler for ext int 0
   \                     Int_Handler_INT0:
   \   00000000   93BA               ST      -Y, R27
   \   00000002   93AA               ST      -Y, R26
    173          
    174              // OBS!!!
    175              // Uses UART16552[].TxStatus as intreason and
    176              // UART16552[].TxSeqCnt as counter because these needs to be globale 
    177              // by using OS_EnterIntStack()
    178          
    179              
    180              switch (UnitID) {
   \   00000004   9100....           LDS     R16, UnitID
   \   00000008   5000               SUBI    R16, 0
   \   0000000A   F021               BREQ    ??Int_Handler_INT0_0
   \   0000000C   950A               DEC     R16
   \   0000000E   F409               BRNE    $+2+2
   \   00000010   C0DF               RJMP    ??Int_Handler_INT0_1
   \   00000012   C0E3               RJMP    ??Int_Handler_INT0_2
    181              case 0x00:                  // AN-ZB485  
    182          #if USE_16552_DRIVER_TASK == 1
    183                    UART16552[0].TxStatus = (U0_IIR & 0x0f);          // reason for interrupt
   \                     ??Int_Handler_INT0_0:
   \   00000014   9100220A           LDS     R16, 8714
   \   00000018   700F               ANDI    R16, 0x0F
   \   0000001A   9300....           STS     (UART16552 + 8), R16
    184                  do {
    185                      switch (UART16552[0].TxStatus) {
   \                     ??Int_Handler_INT0_3:
   \   0000001E   9100....           LDS     R16, (UART16552 + 8)
   \   00000022   5000               SUBI    R16, 0
   \   00000024   F409               BRNE    $+2+2
   \   00000026   C0C7               RJMP    ??Int_Handler_INT0_4
   \   00000028   5002               SUBI    R16, 2
   \   0000002A   F051               BREQ    ??Int_Handler_INT0_5
   \   0000002C   5002               SUBI    R16, 2
   \   0000002E   F409               BRNE    $+2+2
   \   00000030   C049               RJMP    ??Int_Handler_INT0_6
   \   00000032   5002               SUBI    R16, 2
   \   00000034   F409               BRNE    $+2+2
   \   00000036   C0BC               RJMP    ??Int_Handler_INT0_7
   \   00000038   5006               SUBI    R16, 6
   \   0000003A   F409               BRNE    $+2+2
   \   0000003C   C043               RJMP    ??Int_Handler_INT0_6
   \   0000003E   C0BD               RJMP    ??Int_Handler_INT0_8
    186                      case 0x02 :             // transmit holding reg emty
    187                          if (UART16552[0].TxCount == 0) {
   \                     ??Int_Handler_INT0_5:
   \   00000040   ....               LDI     R30, LOW(UART16552)
   \   00000042   ....               LDI     R31, (UART16552) >> 8
   \   00000044   8106               LDD     R16, Z+6
   \   00000046   8117               LDD     R17, Z+7
   \   00000048   2B01               OR      R16, R17
   \   0000004A   F451               BRNE    ??Int_Handler_INT0_9
    188                              U0_MCR &= ~RTS;        // set RTS off
   \   0000004C   E0EC               LDI     R30, LOW(8716)
   \   0000004E   E2F2               LDI     R31, (8716) >> 8
   \   00000050   8100               LD      R16, Z
   \   00000052   7F0D               ANDI    R16, 0xFD
   \   00000054   8300               ST      Z, R16
    189                              OS_StopTimer(&TimerUART0);                    // and stop timer
   \   00000056   ....               LDI     R16, LOW(TimerUART0)
   \   00000058   ....               LDI     R17, (TimerUART0) >> 8
   \   0000005A   ........           CALL    OS_StopTimer
   \   0000005E   C0AD               RJMP    ??Int_Handler_INT0_8
    190                          } else {
    191                              for (UART16552[0].TxSeqCnt = 0;( UART16552[0].TxSeqCnt < FIFO_TX_BUFSIZE ) && (UART16552[0].TxCount > 0 ); UART16552[0].TxSeqCnt++, --UART16552[0].TxCount) {
   \                     ??Int_Handler_INT0_9:
   \   00000060   E000               LDI     R16, 0
   \   00000062   9300....           STS     (UART16552 + 9), R16
   \                     ??Int_Handler_INT0_10:
   \   00000066   9100....           LDS     R16, (UART16552 + 9)
   \   0000006A   3100               CPI     R16, 16
   \   0000006C   F550               BRCC    ??Int_Handler_INT0_11
   \   0000006E   ....               LDI     R30, LOW(UART16552)
   \   00000070   ....               LDI     R31, (UART16552) >> 8
   \   00000072   8106               LDD     R16, Z+6
   \   00000074   8117               LDD     R17, Z+7
   \   00000076   2B01               OR      R16, R17
   \   00000078   F121               BREQ    ??Int_Handler_INT0_11
    192                                  U0_THR = UART16552[0].pTxBuffer[UART16552[0].TxLast++];
   \   0000007A   ....               LDI     R30, LOW(UART16552)
   \   0000007C   ....               LDI     R31, (UART16552) >> 8
   \   0000007E   8104               LDD     R16, Z+4
   \   00000080   8115               LDD     R17, Z+5
   \   00000082   ....               LDI     R26, LOW(UART16552)
   \   00000084   ....               LDI     R27, (UART16552) >> 8
   \   00000086   91ED               LD      R30, X+
   \   00000088   91FC               LD      R31, X
   \   0000008A   9711               SBIW    R27:R26, 1
   \   0000008C   0FE0               ADD     R30, R16
   \   0000008E   1FF1               ADC     R31, R17
   \   00000090   8100               LD      R16, Z
   \   00000092   93002208           STS     8712, R16
   \   00000096   ....               LDI     R30, LOW(UART16552)
   \   00000098   ....               LDI     R31, (UART16552) >> 8
   \   0000009A   8104               LDD     R16, Z+4
   \   0000009C   8115               LDD     R17, Z+5
   \   0000009E   5F0F               SUBI    R16, 255
   \   000000A0   4F1F               SBCI    R17, 255
   \   000000A2   8304               STD     Z+4, R16
   \   000000A4   8315               STD     Z+5, R17
    193                              }
   \   000000A6   9100....           LDS     R16, (UART16552 + 9)
   \   000000AA   9503               INC     R16
   \   000000AC   9300....           STS     (UART16552 + 9), R16
   \   000000B0   ....               LDI     R30, LOW(UART16552)
   \   000000B2   ....               LDI     R31, (UART16552) >> 8
   \   000000B4   8106               LDD     R16, Z+6
   \   000000B6   8117               LDD     R17, Z+7
   \   000000B8   5001               SUBI    R16, 1
   \   000000BA   4010               SBCI    R17, 0
   \   000000BC   8306               STD     Z+6, R16
   \   000000BE   8317               STD     Z+7, R17
   \   000000C0   CFD2               RJMP    ??Int_Handler_INT0_10
    194                          }
    195                          break;
   \                     ??Int_Handler_INT0_11:
   \   000000C2   C07B               RJMP    ??Int_Handler_INT0_8
    196                      case 0x04 :             // Receive data available    
    197                      case 0x0C :             // or caracter timeout (FIFO)
    198                          while (U0_LSR & DATA_READY) {
   \                     ??Int_Handler_INT0_6:
   \   000000C4   E0ED               LDI     R30, LOW(8717)
   \   000000C6   E2F2               LDI     R31, (8717) >> 8
   \   000000C8   8100               LD      R16, Z
   \   000000CA   FF00               SBRS    R16, 0
   \   000000CC   C076               RJMP    ??Int_Handler_INT0_8
    199          
    200                              UART16552[0].pRxBuffer[ UART16552[0].RxFirst ] = U0_RBR;             // Read the character 
   \   000000CE   91002208           LDS     R16, 8712
   \   000000D2   ....               LDI     R26, LOW((UART16552 + 10))
   \   000000D4   ....               LDI     R27, HIGH((UART16552 + 10))
   \   000000D6   91ED               LD      R30, X+
   \   000000D8   91FC               LD      R31, X
   \   000000DA   9711               SBIW    R27:R26, 1
   \   000000DC   ....               LDI     R26, LOW((UART16552 + 12))
   \   000000DE   ....               LDI     R27, HIGH((UART16552 + 12))
   \   000000E0   912D               LD      R18, X+
   \   000000E2   913C               LD      R19, X
   \   000000E4   9711               SBIW    R27:R26, 1
   \   000000E6   0FE2               ADD     R30, R18
   \   000000E8   1FF3               ADC     R31, R19
   \   000000EA   8300               ST      Z, R16
    201          
    202                              if (UART16552[0].RxState != HANDLE) {                 // ok to receive? 
   \   000000EC   9100....           LDS     R16, (UART16552 + 18)
   \   000000F0   300A               CPI     R16, 10
   \   000000F2   F341               BREQ    ??Int_Handler_INT0_6
    203                                  switch (UART16552[0].RxState) {                   // Yes, check state
   \   000000F4   9100....           LDS     R16, (UART16552 + 18)
   \   000000F8   2300               TST     R16
   \   000000FA   F009               BREQ    $+2+2
   \   000000FC   C041               RJMP    ??Int_Handler_INT0_12
    204                                  case SYNC :
    205                                      if ( UART16552[0].pRxBuffer[ UART16552[0].RxFirst ] == ANPRO1_SYN) {
   \   000000FE   ....               LDI     R26, LOW((UART16552 + 10))
   \   00000100   ....               LDI     R27, HIGH((UART16552 + 10))
   \   00000102   91ED               LD      R30, X+
   \   00000104   91FC               LD      R31, X
   \   00000106   9711               SBIW    R27:R26, 1
   \   00000108   ....               LDI     R26, LOW((UART16552 + 12))
   \   0000010A   ....               LDI     R27, HIGH((UART16552 + 12))
   \   0000010C   910D               LD      R16, X+
   \   0000010E   911C               LD      R17, X
   \   00000110   9711               SBIW    R27:R26, 1
   \   00000112   0FE0               ADD     R30, R16
   \   00000114   1FF1               ADC     R31, R17
   \   00000116   8100               LD      R16, Z
   \   00000118   3002               CPI     R16, 2
   \   0000011A   F461               BRNE    ??Int_Handler_INT0_13
    206                                          UART16552[0].SyncCnt ++ ;                 // count sync
   \   0000011C   9100....           LDS     R16, (UART16552 + 19)
   \   00000120   9503               INC     R16
   \   00000122   9300....           STS     (UART16552 + 19), R16
    207                                          UART16552[0].RxFirst = 0;                 // start at start of buff
   \   00000126   ....               LDI     R30, LOW(UART16552)
   \   00000128   ....               LDI     R31, (UART16552) >> 8
   \   0000012A   E000               LDI     R16, 0
   \   0000012C   8704               STD     Z+12, R16
   \   0000012E   E000               LDI     R16, 0
   \   00000130   8705               STD     Z+13, R16
   \   00000132   CFC8               RJMP    ??Int_Handler_INT0_6
    208                                      } else if (UART16552[0].SyncCnt >= 2) {       // minimum two sync bytes
   \                     ??Int_Handler_INT0_13:
   \   00000134   9100....           LDS     R16, (UART16552 + 19)
   \   00000138   3002               CPI     R16, 2
   \   0000013A   F0F0               BRCS    ??Int_Handler_INT0_14
    209                                          UART16552[0].SyncCnt = 0 ;                // reset counter
   \   0000013C   E000               LDI     R16, 0
   \   0000013E   9300....           STS     (UART16552 + 19), R16
    210                                          UART16552[0].RxState = HEADER ;
   \   00000142   E001               LDI     R16, 1
   \   00000144   9300....           STS     (UART16552 + 18), R16
    211                                          UART16552[0].RxLast = 0 ;
   \   00000148   ....               LDI     R30, LOW(UART16552)
   \   0000014A   ....               LDI     R31, (UART16552) >> 8
   \   0000014C   E000               LDI     R16, 0
   \   0000014E   8706               STD     Z+14, R16
   \   00000150   E000               LDI     R16, 0
   \   00000152   8707               STD     Z+15, R16
    212                                          UART16552[0].RxTimeout = RX_TO_TIME ;   // reset timeout
   \   00000154   ....               LDI     R30, LOW(UART16552)
   \   00000156   ....               LDI     R31, (UART16552) >> 8
   \   00000158   EF0A               LDI     R16, 250
   \   0000015A   E010               LDI     R17, 0
   \   0000015C   8B04               STD     Z+20, R16
   \   0000015E   8B15               STD     Z+21, R17
    213                                          UART16552[0].RxFirst++ ;                 //  1. char OK, start on next
   \   00000160   ....               LDI     R30, LOW(UART16552)
   \   00000162   ....               LDI     R31, (UART16552) >> 8
   \   00000164   8504               LDD     R16, Z+12
   \   00000166   8515               LDD     R17, Z+13
   \   00000168   5F0F               SUBI    R16, 255
   \   0000016A   4F1F               SBCI    R17, 255
   \   0000016C   8704               STD     Z+12, R16
   \   0000016E   8715               STD     Z+13, R17
    214                                          ReceivePacketUart16552(0) ;              // Check package
   \   00000170   E000               LDI     R16, 0
   \   00000172   ........           CALL    ReceivePacketUart16552
   \   00000176   CFA6               RJMP    ??Int_Handler_INT0_6
    215                                      } else {
    216                                          UART16552[0].SyncCnt = 0 ;                // start over once more
   \                     ??Int_Handler_INT0_14:
   \   00000178   E000               LDI     R16, 0
   \   0000017A   9300....           STS     (UART16552 + 19), R16
    217                                      }
    218                                      break;
   \   0000017E   CFA2               RJMP    ??Int_Handler_INT0_6
    219                                  default :
    220                                      if ((++UART16552[0].RxFirst) > RXSIZE_UART_16552) { // Point to next location
   \                     ??Int_Handler_INT0_12:
   \   00000180   ....               LDI     R30, LOW(UART16552)
   \   00000182   ....               LDI     R31, (UART16552) >> 8
   \   00000184   8504               LDD     R16, Z+12
   \   00000186   8515               LDD     R17, Z+13
   \   00000188   5F0F               SUBI    R16, 255
   \   0000018A   4F1F               SBCI    R17, 255
   \   0000018C   8704               STD     Z+12, R16
   \   0000018E   8715               STD     Z+13, R17
   \   00000190   ....               LDI     R30, LOW(UART16552)
   \   00000192   ....               LDI     R31, (UART16552) >> 8
   \   00000194   8504               LDD     R16, Z+12
   \   00000196   8515               LDD     R17, Z+13
   \   00000198   3709               CPI     R16, 121
   \   0000019A   E020               LDI     R18, 0
   \   0000019C   0712               CPC     R17, R18
   \   0000019E   F020               BRCS    ??Int_Handler_INT0_15
    221                                          GoToSyncUART16552(0) ;                       // go to sync mode
   \   000001A0   E000               LDI     R16, 0
   \   000001A2   ........           CALL    GoToSyncUART16552
   \   000001A6   CF8E               RJMP    ??Int_Handler_INT0_6
    222                                      } else {
    223                                          ReceivePacketUart16552(0) ;              // Check package
   \                     ??Int_Handler_INT0_15:
   \   000001A8   E000               LDI     R16, 0
   \   000001AA   ........           CALL    ReceivePacketUart16552
    224                                      }
    225                                      break ;   
   \   000001AE   CF8A               RJMP    ??Int_Handler_INT0_6
    226                                  }
    227                              }
    228                          } 
    229                          break;
    230                      case 0x06 :                 // Receiver line status, OR, PE, FR, Break int.
    231                          U0_LSR;      // Dummy read to empty register        
   \                     ??Int_Handler_INT0_7:
   \   000001B0   9100220D           LDS     R16, 8717
    232                          break;
   \   000001B4   C002               RJMP    ??Int_Handler_INT0_8
    233                      case 0x00 :                 // Modem status.
    234                          U0_MSR;      // Dummy read to empty register           
   \                     ??Int_Handler_INT0_4:
   \   000001B6   9100220E           LDS     R16, 8718
    235                          break;
    236                      }
    237                      UART16552[0].TxStatus = (U0_IIR & 0x0f) ;      // reason for interrupt, 
   \                     ??Int_Handler_INT0_8:
   \   000001BA   9100220A           LDS     R16, 8714
   \   000001BE   700F               ANDI    R16, 0x0F
   \   000001C0   9300....           STS     (UART16552 + 8), R16
    238                                                                                // check again before exit to avoid lost int. and hang
    239                  } while ((UART16552[0].TxStatus & 0x01) != 0x01) ;  
   \   000001C4   ....               LDI     R30, LOW(UART16552)
   \   000001C6   ....               LDI     R31, (UART16552) >> 8
   \   000001C8   8500               LDD     R16, Z+8
   \   000001CA   FF00               SBRS    R16, 0
   \   000001CC   CF28               RJMP    ??Int_Handler_INT0_3
    240          #else
    241                  OS_SignalEvent(0x01, &TCB_16552_DRIVER) ;
    242          #endif
    243                  break;
   \   000001CE   C005               RJMP    ??Int_Handler_INT0_2
    244              case 0x01:                  // AN-ZBANA ADready
    245                  OS_SignalEvent(1, &TCB_AD7715);
   \                     ??Int_Handler_INT0_1:
   \   000001D0   ....               LDI     R18, LOW(TCB_AD7715)
   \   000001D2   ....               LDI     R19, (TCB_AD7715) >> 8
   \   000001D4   E001               LDI     R16, 1
   \   000001D6   ........           CALL    OS_SignalEvent
    246                  break;
    247              }
    248          }
   \                     ??Int_Handler_INT0_2:
   \   000001DA   91A9               LD      R26, Y+
   \   000001DC   91B9               LD      R27, Y+
   \   000001DE   9508               RET
    249          
    250          
    251          #pragma vector=INT0_vect

   \                                 In  segment CODE, align 2, keep-with-next
    252          __interrupt void IntHandler_INT0( void ){               //Int handler for ext int 0
   \                     IntHandler_INT0:
   \   00000000   939A               ST      -Y, R25
   \   00000002   938A               ST      -Y, R24
   \   00000004   93FA               ST      -Y, R31
   \   00000006   93EA               ST      -Y, R30
   \   00000008   923A               ST      -Y, R3
   \   0000000A   922A               ST      -Y, R2
   \   0000000C   921A               ST      -Y, R1
   \   0000000E   920A               ST      -Y, R0
   \   00000010   937A               ST      -Y, R23
   \   00000012   936A               ST      -Y, R22
   \   00000014   935A               ST      -Y, R21
   \   00000016   934A               ST      -Y, R20
   \   00000018   933A               ST      -Y, R19
   \   0000001A   932A               ST      -Y, R18
   \   0000001C   931A               ST      -Y, R17
   \   0000001E   930A               ST      -Y, R16
   \   00000020   B78F               IN      R24, 0x3F
   \   00000022   B79B               IN      R25, 0x3B
    253              OS_CallISR(Int_Handler_INT0);
   \   00000024   ....               LDI     R16, LOW(Int_Handler_INT0/2)
   \   00000026   ....               LDI     R17, (Int_Handler_INT0/2) >> 8
   \   00000028   ........           CALL    OS_CallISR_Debug
    254          }
   \   0000002C   BF9B               OUT     0x3B, R25
   \   0000002E   BF8F               OUT     0x3F, R24
   \   00000030   9109               LD      R16, Y+
   \   00000032   9119               LD      R17, Y+
   \   00000034   9129               LD      R18, Y+
   \   00000036   9139               LD      R19, Y+
   \   00000038   9149               LD      R20, Y+
   \   0000003A   9159               LD      R21, Y+
   \   0000003C   9169               LD      R22, Y+
   \   0000003E   9179               LD      R23, Y+
   \   00000040   9009               LD      R0, Y+
   \   00000042   9019               LD      R1, Y+
   \   00000044   9029               LD      R2, Y+
   \   00000046   9039               LD      R3, Y+
   \   00000048   91E9               LD      R30, Y+
   \   0000004A   91F9               LD      R31, Y+
   \   0000004C   9189               LD      R24, Y+
   \   0000004E   9199               LD      R25, Y+
   \   00000050   9518               RETI
    255          
    256          /*************************************************************************
    257          *
    258          *  External int 1 (UART PC16554 on AN-ZB485)
    259          *
    260          *************************************************************************/

   \                                 In  segment CODE, align 2, keep-with-next
    261          void Int_Handler_INT1( void ){               //Int handler for Ext int 1
   \                     Int_Handler_INT1:
   \   00000000   93BA               ST      -Y, R27
   \   00000002   93AA               ST      -Y, R26
    262          
    263              // OBS!!!
    264              // Uses UART16552[].TxStatus as intreason and
    265              // UART16552[].TxSeqCnt as counter because these needs to be globale 
    266              // by using OS_EnterIntStack()
    267              
    268              switch (UnitID) {
   \   00000004   9100....           LDS     R16, UnitID
   \   00000008   5000               SUBI    R16, 0
   \   0000000A   F021               BREQ    ??Int_Handler_INT1_0
   \   0000000C   950A               DEC     R16
   \   0000000E   F409               BRNE    $+2+2
   \   00000010   C0DF               RJMP    ??Int_Handler_INT1_1
   \   00000012   C0DE               RJMP    ??Int_Handler_INT1_1
    269              case 0x00:               // AN-ZB485 
    270          #if USE_16552_DRIVER_TASK == 1
    271                  UART16552[1].TxStatus = (U1_IIR & 0x0f) ;      // reason for interrupt
   \                     ??Int_Handler_INT1_0:
   \   00000014   91002202           LDS     R16, 8706
   \   00000018   700F               ANDI    R16, 0x0F
   \   0000001A   9300....           STS     (UART16552 + 34), R16
    272                  do {
    273                      switch (UART16552[1].TxStatus) {
   \                     ??Int_Handler_INT1_2:
   \   0000001E   9100....           LDS     R16, (UART16552 + 34)
   \   00000022   5000               SUBI    R16, 0
   \   00000024   F409               BRNE    $+2+2
   \   00000026   C0C8               RJMP    ??Int_Handler_INT1_3
   \   00000028   5002               SUBI    R16, 2
   \   0000002A   F051               BREQ    ??Int_Handler_INT1_4
   \   0000002C   5002               SUBI    R16, 2
   \   0000002E   F409               BRNE    $+2+2
   \   00000030   C04A               RJMP    ??Int_Handler_INT1_5
   \   00000032   5002               SUBI    R16, 2
   \   00000034   F409               BRNE    $+2+2
   \   00000036   C0BD               RJMP    ??Int_Handler_INT1_6
   \   00000038   5006               SUBI    R16, 6
   \   0000003A   F409               BRNE    $+2+2
   \   0000003C   C044               RJMP    ??Int_Handler_INT1_5
   \   0000003E   C0BE               RJMP    ??Int_Handler_INT1_7
    274                      case 0x02 :             // transmit holding reg emty
    275                          if (UART16552[1].TxCount == 0) {
   \                     ??Int_Handler_INT1_4:
   \   00000040   ....               LDI     R30, LOW(UART16552)
   \   00000042   ....               LDI     R31, (UART16552) >> 8
   \   00000044   A100               LDD     R16, Z+32
   \   00000046   A111               LDD     R17, Z+33
   \   00000048   2B01               OR      R16, R17
   \   0000004A   F451               BRNE    ??Int_Handler_INT1_8
    276                              U1_MCR &= ~RTS;        // set RTS off
   \   0000004C   E0E4               LDI     R30, LOW(8708)
   \   0000004E   E2F2               LDI     R31, (8708) >> 8
   \   00000050   8100               LD      R16, Z
   \   00000052   7F0D               ANDI    R16, 0xFD
   \   00000054   8300               ST      Z, R16
    277                              OS_StopTimer(&TimerUART1);                    // and stop timer
   \   00000056   ....               LDI     R16, LOW(TimerUART1)
   \   00000058   ....               LDI     R17, (TimerUART1) >> 8
   \   0000005A   ........           CALL    OS_StopTimer
   \   0000005E   C0AE               RJMP    ??Int_Handler_INT1_7
    278                          } else {
    279                              for (UART16552[1].TxSeqCnt = 0;( UART16552[1].TxSeqCnt < FIFO_TX_BUFSIZE ) && (UART16552[1].TxCount > 0 ); UART16552[1].TxSeqCnt++, UART16552[1].TxCount--) {
   \                     ??Int_Handler_INT1_8:
   \   00000060   E000               LDI     R16, 0
   \   00000062   9300....           STS     (UART16552 + 35), R16
   \                     ??Int_Handler_INT1_9:
   \   00000066   9100....           LDS     R16, (UART16552 + 35)
   \   0000006A   3100               CPI     R16, 16
   \   0000006C   F558               BRCC    ??Int_Handler_INT1_10
   \   0000006E   ....               LDI     R30, LOW(UART16552)
   \   00000070   ....               LDI     R31, (UART16552) >> 8
   \   00000072   A100               LDD     R16, Z+32
   \   00000074   A111               LDD     R17, Z+33
   \   00000076   2B01               OR      R16, R17
   \   00000078   F129               BREQ    ??Int_Handler_INT1_10
    280                                 U1_THR = UART16552[1].pTxBuffer[UART16552[1].TxLast++] ;
   \   0000007A   ....               LDI     R26, LOW((UART16552 + 26))
   \   0000007C   ....               LDI     R27, HIGH((UART16552 + 26))
   \   0000007E   91ED               LD      R30, X+
   \   00000080   91FC               LD      R31, X
   \   00000082   9711               SBIW    R27:R26, 1
   \   00000084   ....               LDI     R26, LOW((UART16552 + 30))
   \   00000086   ....               LDI     R27, HIGH((UART16552 + 30))
   \   00000088   910D               LD      R16, X+
   \   0000008A   911C               LD      R17, X
   \   0000008C   9711               SBIW    R27:R26, 1
   \   0000008E   0FE0               ADD     R30, R16
   \   00000090   1FF1               ADC     R31, R17
   \   00000092   8100               LD      R16, Z
   \   00000094   93002200           STS     8704, R16
   \   00000098   ....               LDI     R30, LOW(UART16552)
   \   0000009A   ....               LDI     R31, (UART16552) >> 8
   \   0000009C   8D06               LDD     R16, Z+30
   \   0000009E   8D17               LDD     R17, Z+31
   \   000000A0   5F0F               SUBI    R16, 255
   \   000000A2   4F1F               SBCI    R17, 255
   \   000000A4   8F06               STD     Z+30, R16
   \   000000A6   8F17               STD     Z+31, R17
    281                              }
   \   000000A8   9100....           LDS     R16, (UART16552 + 35)
   \   000000AC   9503               INC     R16
   \   000000AE   9300....           STS     (UART16552 + 35), R16
   \   000000B2   ....               LDI     R30, LOW(UART16552)
   \   000000B4   ....               LDI     R31, (UART16552) >> 8
   \   000000B6   A100               LDD     R16, Z+32
   \   000000B8   A111               LDD     R17, Z+33
   \   000000BA   5001               SUBI    R16, 1
   \   000000BC   4010               SBCI    R17, 0
   \   000000BE   A300               STD     Z+32, R16
   \   000000C0   A311               STD     Z+33, R17
   \   000000C2   CFD1               RJMP    ??Int_Handler_INT1_9
    282                          }
    283                          break;
   \                     ??Int_Handler_INT1_10:
   \   000000C4   C07B               RJMP    ??Int_Handler_INT1_7
    284                      case 0x04 :             // Receive data available    
    285                      case 0x0C :             // or caracter timeout (FIFO)
    286                          while (U1_LSR & DATA_READY) {
   \                     ??Int_Handler_INT1_5:
   \   000000C6   E0E5               LDI     R30, LOW(8709)
   \   000000C8   E2F2               LDI     R31, (8709) >> 8
   \   000000CA   8100               LD      R16, Z
   \   000000CC   FF00               SBRS    R16, 0
   \   000000CE   C076               RJMP    ??Int_Handler_INT1_7
    287          
    288                              UART16552[1].pRxBuffer[ UART16552[1].RxFirst ] = U1_RBR;          // Read the character 
   \   000000D0   91002200           LDS     R16, 8704
   \   000000D4   ....               LDI     R26, LOW((UART16552 + 36))
   \   000000D6   ....               LDI     R27, HIGH((UART16552 + 36))
   \   000000D8   91ED               LD      R30, X+
   \   000000DA   91FC               LD      R31, X
   \   000000DC   9711               SBIW    R27:R26, 1
   \   000000DE   ....               LDI     R26, LOW((UART16552 + 38))
   \   000000E0   ....               LDI     R27, HIGH((UART16552 + 38))
   \   000000E2   912D               LD      R18, X+
   \   000000E4   913C               LD      R19, X
   \   000000E6   9711               SBIW    R27:R26, 1
   \   000000E8   0FE2               ADD     R30, R18
   \   000000EA   1FF3               ADC     R31, R19
   \   000000EC   8300               ST      Z, R16
    289          
    290                              if (UART16552[1].RxState != HANDLE) {        // ok to receive? 
   \   000000EE   9100....           LDS     R16, (UART16552 + 44)
   \   000000F2   300A               CPI     R16, 10
   \   000000F4   F341               BREQ    ??Int_Handler_INT1_5
    291                                  switch (UART16552[1].RxState) {                   // Yes, check state
   \   000000F6   9100....           LDS     R16, (UART16552 + 44)
   \   000000FA   2300               TST     R16
   \   000000FC   F009               BREQ    $+2+2
   \   000000FE   C041               RJMP    ??Int_Handler_INT1_11
    292                                  case SYNC :
    293                                      if ( UART16552[1].pRxBuffer[ UART16552[1].RxFirst ] == ANPRO1_SYN) {
   \   00000100   ....               LDI     R26, LOW((UART16552 + 36))
   \   00000102   ....               LDI     R27, HIGH((UART16552 + 36))
   \   00000104   91ED               LD      R30, X+
   \   00000106   91FC               LD      R31, X
   \   00000108   9711               SBIW    R27:R26, 1
   \   0000010A   ....               LDI     R26, LOW((UART16552 + 38))
   \   0000010C   ....               LDI     R27, HIGH((UART16552 + 38))
   \   0000010E   910D               LD      R16, X+
   \   00000110   911C               LD      R17, X
   \   00000112   9711               SBIW    R27:R26, 1
   \   00000114   0FE0               ADD     R30, R16
   \   00000116   1FF1               ADC     R31, R17
   \   00000118   8100               LD      R16, Z
   \   0000011A   3002               CPI     R16, 2
   \   0000011C   F461               BRNE    ??Int_Handler_INT1_12
    294                                          UART16552[1].SyncCnt ++ ;                 // count sync
   \   0000011E   9100....           LDS     R16, (UART16552 + 45)
   \   00000122   9503               INC     R16
   \   00000124   9300....           STS     (UART16552 + 45), R16
    295                                          UART16552[1].RxFirst = 0;                 // start at start of buff
   \   00000128   ....               LDI     R30, LOW(UART16552)
   \   0000012A   ....               LDI     R31, (UART16552) >> 8
   \   0000012C   E000               LDI     R16, 0
   \   0000012E   A306               STD     Z+38, R16
   \   00000130   E000               LDI     R16, 0
   \   00000132   A307               STD     Z+39, R16
   \   00000134   CFC8               RJMP    ??Int_Handler_INT1_5
    296                                      } else if (UART16552[1].SyncCnt >= 2) {       // minimum two sync bytes
   \                     ??Int_Handler_INT1_12:
   \   00000136   9100....           LDS     R16, (UART16552 + 45)
   \   0000013A   3002               CPI     R16, 2
   \   0000013C   F0F0               BRCS    ??Int_Handler_INT1_13
    297                                          UART16552[1].SyncCnt = 0 ;                // reset counter
   \   0000013E   E000               LDI     R16, 0
   \   00000140   9300....           STS     (UART16552 + 45), R16
    298                                          UART16552[1].RxState = HEADER ;
   \   00000144   E001               LDI     R16, 1
   \   00000146   9300....           STS     (UART16552 + 44), R16
    299                                          UART16552[1].RxLast = 0 ;
   \   0000014A   ....               LDI     R30, LOW(UART16552)
   \   0000014C   ....               LDI     R31, (UART16552) >> 8
   \   0000014E   E000               LDI     R16, 0
   \   00000150   A700               STD     Z+40, R16
   \   00000152   E000               LDI     R16, 0
   \   00000154   A701               STD     Z+41, R16
    300                                          UART16552[1].RxTimeout = RX_TO_TIME ;     // reset timeout
   \   00000156   ....               LDI     R30, LOW(UART16552)
   \   00000158   ....               LDI     R31, (UART16552) >> 8
   \   0000015A   EF0A               LDI     R16, 250
   \   0000015C   E010               LDI     R17, 0
   \   0000015E   A706               STD     Z+46, R16
   \   00000160   A717               STD     Z+47, R17
    301                                          UART16552[1].RxFirst++ ;                  //  1. char OK, start on next
   \   00000162   ....               LDI     R30, LOW(UART16552)
   \   00000164   ....               LDI     R31, (UART16552) >> 8
   \   00000166   A106               LDD     R16, Z+38
   \   00000168   A117               LDD     R17, Z+39
   \   0000016A   5F0F               SUBI    R16, 255
   \   0000016C   4F1F               SBCI    R17, 255
   \   0000016E   A306               STD     Z+38, R16
   \   00000170   A317               STD     Z+39, R17
    302                                          ReceivePacketUart16552(1) ;               // Check package
   \   00000172   E001               LDI     R16, 1
   \   00000174   ........           CALL    ReceivePacketUart16552
   \   00000178   CFA6               RJMP    ??Int_Handler_INT1_5
    303                                      } else {
    304                                          UART16552[1].SyncCnt = 0 ;                // start over once more
   \                     ??Int_Handler_INT1_13:
   \   0000017A   E000               LDI     R16, 0
   \   0000017C   9300....           STS     (UART16552 + 45), R16
    305                                      }
    306                                      break;
   \   00000180   CFA2               RJMP    ??Int_Handler_INT1_5
    307                                  default :
    308                                      if ((++UART16552[1].RxFirst) > RXSIZE_UART_16552) { // Point to next location
   \                     ??Int_Handler_INT1_11:
   \   00000182   ....               LDI     R30, LOW(UART16552)
   \   00000184   ....               LDI     R31, (UART16552) >> 8
   \   00000186   A106               LDD     R16, Z+38
   \   00000188   A117               LDD     R17, Z+39
   \   0000018A   5F0F               SUBI    R16, 255
   \   0000018C   4F1F               SBCI    R17, 255
   \   0000018E   A306               STD     Z+38, R16
   \   00000190   A317               STD     Z+39, R17
   \   00000192   ....               LDI     R30, LOW(UART16552)
   \   00000194   ....               LDI     R31, (UART16552) >> 8
   \   00000196   A106               LDD     R16, Z+38
   \   00000198   A117               LDD     R17, Z+39
   \   0000019A   3709               CPI     R16, 121
   \   0000019C   E020               LDI     R18, 0
   \   0000019E   0712               CPC     R17, R18
   \   000001A0   F020               BRCS    ??Int_Handler_INT1_14
    309                                          GoToSyncUART16552(1) ;                       // go to sync mode
   \   000001A2   E001               LDI     R16, 1
   \   000001A4   ........           CALL    GoToSyncUART16552
   \   000001A8   CF8E               RJMP    ??Int_Handler_INT1_5
    310                                      } else {
    311                                          ReceivePacketUart16552(1) ;              // Check package
   \                     ??Int_Handler_INT1_14:
   \   000001AA   E001               LDI     R16, 1
   \   000001AC   ........           CALL    ReceivePacketUart16552
    312                                      }
    313                                      break ;   
   \   000001B0   CF8A               RJMP    ??Int_Handler_INT1_5
    314                                  }
    315                              }
    316                          }
    317                          break;
    318                      case 0x06 :                 // Receiver line status, OR, PE, FR, Break int.
    319                          U1_LSR;      // Dummy read to empty register        
   \                     ??Int_Handler_INT1_6:
   \   000001B2   91002205           LDS     R16, 8709
    320                          break;
   \   000001B6   C002               RJMP    ??Int_Handler_INT1_7
    321                      case 0x00 :                 // Modem status.
    322                          U1_MSR;      // Dummy read to empty register           
   \                     ??Int_Handler_INT1_3:
   \   000001B8   91002206           LDS     R16, 8710
    323                          break;
    324                      }
    325                      UART16552[1].TxStatus = (U1_IIR & 0x0f) ;      // reason for interrupt, 
   \                     ??Int_Handler_INT1_7:
   \   000001BC   91002202           LDS     R16, 8706
   \   000001C0   700F               ANDI    R16, 0x0F
   \   000001C2   9300....           STS     (UART16552 + 34), R16
    326                                                                                // check again before exit to avoid lost int. and hang
    327                 } while ((UART16552[1].TxStatus & 0x01) != 0x01);  
   \   000001C6   ....               LDI     R30, LOW(UART16552)
   \   000001C8   ....               LDI     R31, (UART16552) >> 8
   \   000001CA   A102               LDD     R16, Z+34
   \   000001CC   FF00               SBRS    R16, 0
   \   000001CE   CF27               RJMP    ??Int_Handler_INT1_2
    328          #else
    329                  OS_SignalEvent(0x02, &TCB_16552_DRIVER);
    330          #endif
    331                  break;
    332              case 0x01:                  // AN-ZBANA Not connected!
    333                  break;
    334              }
    335          }
   \                     ??Int_Handler_INT1_1:
   \   000001D0   91A9               LD      R26, Y+
   \   000001D2   91B9               LD      R27, Y+
   \   000001D4   9508               RET
    336          
    337          
    338          #pragma vector=INT1_vect

   \                                 In  segment CODE, align 2, keep-with-next
    339          __interrupt void IntHandler_INT1( void ){               //Int handler for Ext int 1
   \                     IntHandler_INT1:
   \   00000000   939A               ST      -Y, R25
   \   00000002   938A               ST      -Y, R24
   \   00000004   93FA               ST      -Y, R31
   \   00000006   93EA               ST      -Y, R30
   \   00000008   923A               ST      -Y, R3
   \   0000000A   922A               ST      -Y, R2
   \   0000000C   921A               ST      -Y, R1
   \   0000000E   920A               ST      -Y, R0
   \   00000010   937A               ST      -Y, R23
   \   00000012   936A               ST      -Y, R22
   \   00000014   935A               ST      -Y, R21
   \   00000016   934A               ST      -Y, R20
   \   00000018   933A               ST      -Y, R19
   \   0000001A   932A               ST      -Y, R18
   \   0000001C   931A               ST      -Y, R17
   \   0000001E   930A               ST      -Y, R16
   \   00000020   B78F               IN      R24, 0x3F
   \   00000022   B79B               IN      R25, 0x3B
    340          
    341              OS_CallISR(Int_Handler_INT1);
   \   00000024   ....               LDI     R16, LOW(Int_Handler_INT1/2)
   \   00000026   ....               LDI     R17, (Int_Handler_INT1/2) >> 8
   \   00000028   ........           CALL    OS_CallISR_Debug
    342          }
   \   0000002C   BF9B               OUT     0x3B, R25
   \   0000002E   BF8F               OUT     0x3F, R24
   \   00000030   9109               LD      R16, Y+
   \   00000032   9119               LD      R17, Y+
   \   00000034   9129               LD      R18, Y+
   \   00000036   9139               LD      R19, Y+
   \   00000038   9149               LD      R20, Y+
   \   0000003A   9159               LD      R21, Y+
   \   0000003C   9169               LD      R22, Y+
   \   0000003E   9179               LD      R23, Y+
   \   00000040   9009               LD      R0, Y+
   \   00000042   9019               LD      R1, Y+
   \   00000044   9029               LD      R2, Y+
   \   00000046   9039               LD      R3, Y+
   \   00000048   91E9               LD      R30, Y+
   \   0000004A   91F9               LD      R31, Y+
   \   0000004C   9189               LD      R24, Y+
   \   0000004E   9199               LD      R25, Y+
   \   00000050   9518               RETI

   \                                 In  segment INTVEC, offset 0x4, root
   \                     `??IntHandler_INT0::??INTVEC 4`:
   \   00000004   ........           JMP     IntHandler_INT0

   \                                 In  segment INTVEC, offset 0x8, root
   \                     `??IntHandler_INT1::??INTVEC 8`:
   \   00000008   ........           JMP     IntHandler_INT1

   \                                 In  segment NEAR_ID, align 1, keep-with-next
   \                     `?<Initializer for <Constant "16552_DRIVER">>`:
   \   00000000   363135355F32       DC8 "16552_DRIVER"
   \              524456495245
   \              00          

   \                                 In  segment NEAR_I, align 1, keep-with-next
   \   00000000                      REQUIRE `?<Segment init: NEAR_I>`
   \                     `?<Constant "16552_DRIVER">`:
   \   00000000                      DS8 13
   \   0000000D                      REQUIRE `?<Initializer for <Constant "16552_DRIVER">>`

   Maximum stack usage in bytes:

   CSTACK RSTACK Function
   ------ ------ --------
     16      2   IntHandler_INT0
       16      2   -> OS_CallISR_Debug
     16      2   IntHandler_INT1
       16      2   -> OS_CallISR_Debug
      2      2   Int_Handler_INT0
        2      2   -> GoToSyncUART16552
        2      2   -> OS_SignalEvent
        2      2   -> OS_StopTimer
        2      2   -> ReceivePacketUart16552
      2      2   Int_Handler_INT1
        2      2   -> GoToSyncUART16552
        2      2   -> OS_StopTimer
        2      2   -> ReceivePacketUart16552
      2      2   _16552_0_irq_handler
        2      2   -> GoToSyncUART16552
        2      2   -> OS_StopTimer
        2      2   -> ReceivePacketUart16552
      2      2   _16552_1_irq_handler
        2      2   -> GoToSyncUART16552
        2      2   -> OS_StopTimer
        2      2   -> ReceivePacketUart16552
      1      2   _16552_driver_task
        1      2   -> OS_WaitEventTimed
        1      2   -> _16552_0_irq_handler
        1      2   -> _16552_1_irq_handler
      6      2   _16552_driver_task_init
        0      2   -> OS_CreateTask_D


   Segment part sizes:

   Bytes  Function/Label
   -----  --------------
      13  ?<Constant "16552_DRIVER">
      13  ?<Initializer for <Constant "16552_DRIVER">>
      82  IntHandler_INT0
       4  IntHandler_INT0::??INTVEC 4
      82  IntHandler_INT1
       4  IntHandler_INT1::??INTVEC 8
     480  Int_Handler_INT0
     470  Int_Handler_INT1
      33  TCB_16552_DRIVER
     452  _16552_0_irq_handler
     454  _16552_1_irq_handler
      28  _16552_driver_task
      44  _16552_driver_task_init
     300  stack
      14  -- Other

 
 2 092 bytes in segment CODE
    14 bytes in segment INITTAB
     8 bytes in segment INTVEC
    13 bytes in segment NEAR_I
    13 bytes in segment NEAR_ID
   333 bytes in segment NEAR_Z
 
 2 105 bytes of CODE memory (+ 22 bytes shared)
   346 bytes of DATA memory

Errors: none
Warnings: none
