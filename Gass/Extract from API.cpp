///////////////////////////////////////////////////////////////////////////////////
//
// Gas calculations based on mol
//
///////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
//
// The data is from a Excel document which is the property of Chemgas, one customer of Henri Systems
//
const GasProduct Product[] = {//            Q        F       A       B      MolMass     H       N
    {  "Ammoniak"       , "NH3"         ,405.5,   1.001,  0.2312,  0.2471,   17.032  ,  12.19 ,  1.965, 11,{{-40, 0.6912, -0.2525, -0.29},{-30, 0.6782, 0.1627, 0.19},{-20, 0.6652, 0.7374, 0.89},{-10, 0.6519, 0.15215, 1.89},{0, 0.6381, 2.5606, 3.26},{10, 0.6239, 3.9267, 5.1},{20, 0.6092, 5.688, 7.5},{30, 0.5939, 7.9364, 10.57},{40, 0.5779, 10.775, 14.42},{50, 0.5611, 14.331, 19.17},{60, 0.5443, 18.7295, 24.92}}},
    {  "Butadien"       , "C4H6"        ,425.0,   0.977,  0.2444,  0.2710,   54.090  ,  12.16 ,  1.765, 11,{{-40, 0.6900, 0.557, 0.202},{-30, 0.6585, 0.9735, 0.372},{-20, 0.669, 1.39, 0.542},{-10, 0.645, 2.18, 0.883},{0, 0.645, 2.97, 1.224}, {10, 0.633, 4.17, 1.754}, {20, 0.621, 5.69, 2.437}, {30, 0.609, 7.64, 3.324}, {40, 0.595, 10.02, 4.415}, {50, 0.581, 13.375, 5.93}, {60, 0.567, 16.73, 7.444}}},
    {  "Isobutylene"    , "C4H8"        ,419.2,   1.000,  0.2188,  0.2680,   56.104  ,  12.36 ,  2.600, 11,{{-40, 0.6613, 0.65, 0.23},{-30, 0.6506, 0.99, 0.37},{-20, 0.64, 1.62, 0.59},{-10, 0.6397, 2.34, 0.89},{0, 0.6171, 3.36, 1.31},{10, 0.6053, 4.69, 1.87},{20, 0.5931, 6.39, 2.59},{30, 0.5805, 8.52, 3.5},{40, 0.5674, 11.35, 4.65},{50, 0.5536, 14.72, 6.05},{60, 0.5399, 18.04, 7.45}}},
    {  "Propylene"      , "C3H6"        ,354.9,   1.040,  0.2252,  0.2699,   42.080  ,  12.04 ,  1.765, 11,{{-40, 0.5995, 3.19, 1.4},{-30, 0.5863, 4.66, 2.11},{-20, 0.5731, 6.643, 3.067},{-10, 0.5599, 9.05, 4.28},{0, 0.5457, 12.22, 5.83},{10, 0.5307, 16.25, 7.78},{20, 0.5147, 21.28, 10.16},{30, 0.4977, 27.53, 13.04},{40, 0.4791, 35.703, 16.49},{50, 0.4586, 45.81, 20.56},{60, 0.4381, 56.43, 24.96}}},
    {  "Propenoxide"    , "C3H6O"       ,582.0,   1.000,  0.3123,  0.3015,   58.080  ,  12.80 ,  1.765, 11,{{-40, 0.9028, 0.0033, 0.01},{-30, 0.8905, 0.0313, 0.01},{-20, 0.8782, 0.2108, 0.07},{-10, 0.8659, 0.4, 0.16},{0, 0.8536, 0.6, 0.25},{10, 0.8413, 1, 0.4},{20, 0.829, 1.4, 0.61},{30, 0.8167, 2.1, 0.9},{40, 0.8044, 3.2233, 1.28},{50, 0.7921, 4.4235, 1.79},{60, 0.7798, 6.0166, 2.47}}},
    {  "Vynilchloride"  , "C4H6"        ,429.7,   1.000,  0.3946,  0.3108,   62.500  ,  12.16 ,  1.765, 11,{{-40, 1.0174, 0.4921, 0.15},{-30, 0.9999, 1.4958, 0.47},{-20, 0.9824, 2.398, 0.79},{-10, 0.9649, 3.494, 1.19},{0, 0.9468, 4.967, 1.73},{10, 0.9287, 6.888, 2.46},{20, 0.9104, 9.374, 3.49},{30, 0.8916, 12.446, 4.59},{40, 0.8725, 16.301, 6.88},{50, 0.8534, 23.6689, 8.18},{60, 0.8343, 27.5705, 9.58}}},
    {  "Butane"         , "C4H10"       ,429.7,   0.000,  0.0000,  0.0000,   58.123  ,  12.027,  1.765, 11,{{-40, 0.6400, 0.5487, 0.183},{-30, 0.6306, 0.8625, 0.3},{-20, 0.6210, 1.3199, 0.478},{-10, 0.6107, 1.873, 0.705},{0, 0.6008, 2.7128, 1.06}, {10, 0.5898, 3.7773, 1.53}, {20, 0.5788, 5.0315, 2.11}, {30, 0.5665, 6.6411}, {40, 0.5546, 8.572, 3.84}, {50, 0.5422, 10.9592, 5.08}, {60, 0.5284, 13.6389, 6.5}}},
    {  "Propane"        , "C3H8"        ,429.7,   0.000,  0.0000,  0.0000,   44.096  ,  12.027,  1.765, 11,{{-40, 0.5815, 2.33, 1},{-30, 0.5683, 3.4, 1.5},{-20, 0.5551, 5.57, 2.5},{-10, 0.5419, 7.54, 3.45},{0, 0.5287, 10.23, 4.74}, {10, 0.5147, 13.63, 6.36}, {20, 0.5000, 17.9, 8.36}, {30, 0.4843, 23.18, 10.79}, {40, 0.4647, 29.72, 13.69}, {50, 0.4489, 37.57, 17.14}, {60, 0.4304, 48.47, 21.5}}},
    {  "N-Butane"       , "nC4H8"       ,425.2,   0.000,  0.0000,  0.0000,   58.123  ,  12.027,  1.765, 11,{{-40, 0.6443, 0.3654, 0.12},{-30, 0.6335},{-20, 0.6227, 1.1317, 0.4},{-10, 0.6119, 1.9, 0.7},{0, 0.6011, 2.72, 1.03}, {10, 0.5901, 3.81, 1.48}, {20, 0.5787, 5.23, 2.07}, {30, 0.5669, 7.04, 2.83}, {40, 0.5547, 9.3731, 3.77}, {50, 0.5420, 12.1704, 4.93}, {60, 0.5293, 16.3137, 6.49}}},
    {  "ISO-Butane"     , "I-C4H10"     ,408.1,   0.000,  0.0000,  0.0000,   58.123  ,  12.027,  1.765, 11,{{-40, 0.6262, 0.82, 0.29},{-30, 0.6148, 1.23, 0.44},{-20, 0.6034, 2.06, 0.74},{-10, 0.5920, 2.96, 1.08},{0, 0.5806, 4.18}, {10, 0.5689, 5.79, 2.2}, {20, 0.5568, 7.77, 3}, {30, 0.5442, 10.28, 4.01}, {40, 0.5310, 13.4, 5.25}, {50, 0.5171, 17.21, 6.74}, {60, 0.5032, 22.09, 8.6}}},
    {  "1-Butene"       , "1-C4H8 "     ,425.2,   0.000,  0.0000,  0.0000,   56.107  ,  12.027,  1.765, 11,{{-40, 0.6611, 0.65, 0.22},{-30, 0.6497, 0.98, 0.36},{-20, 0.6383, 1.52, 0.56},{-10, 0.6269, 2.29, 0.87},{0, 0.6155, 3.28, 1.28}, {10, 0.6039, 4.59, 1.83}, {20, 0.5918, 6.26, 2.54}, {30, 0.5794, 8.37, 3.44}, {40, 0.5664, 11.01, 4.56}, {50, 0.5529, 14.27, 5.93}, {60, 0.5394, 18.31, 7.61}}},
    {  "Crude C4"       , "C4"          ,  0.0,   0.000,  0.0000,  0.0000,   55.091  ,  12.027,  1.765, 11,{{-40, 0.6770, 1.1383, 0.115},{-30, 0.6650, 1.4295, 0.241},{-20, 0.6540, 1.3597, 0.531},{-10, 0.642, 2.2352, 0.881},{0, 0.6290, 3.2297, 1.301}, {10, 0.6170, 4.5057, 1.85}, {20, 0.6050, 6.1495, 2.556}, {30, 0.5920, 8.2238, 3.454}, {40, 0.5790, 10.7476, 4.514}, {50, 0.5660, 13.2346, 5.508}, {60, 0.5330, 15.4051, 6.45}}},
    {  "Raffinate 1"    , "C"           ,  0.0,   0.000,  0.0000,  0.0000,   56.4    ,  12.027,  1.765, 11,{{-40, 0.6642, 1.1383, 0.115},{-30, 0.6528, 1.4295, 0.241},{-20, 0.6414, 1.3597, 0.531},{-10, 0.6300, 2.2352, 0.881},{0, 0.6186, 3.2297, 1.301}, {10, 0.6069, 4.5057, 1.85}, {20, 0.5949, 6.1495, 2.556}, {30, 0.5824, 8.2238, 3.454}, {40, 0.5694, 10.7476, 4.514}, {50, 0.5569, 13.2346, 5.508}, {60, 0.5439, 15.4051, 6.45}}},
    {  "Raffinate 2"    , "C"           ,  0.0,   0.000,  0.0000,  0.0000,   56.8    ,  12.027,  1.765, 11,{{-40, 0.6678, 1.1383, 0.115},{-30, 0.6565, 1.4295, 0.241},{-20, 0.6452, 1.3597, 0.531},{-10, 0.6339, 2.2352, 0.881},{0, 0.6226, 3.2297, 1.301}, {10, 0.6113, 4.5057, 1.85}, {20, 0.6001, 6.1495, 2.556}, {30, 0.5889, 8.2238, 3.454}, {40, 0.5776, 10.7476, 4.514}, {50, 0.5663, 13.2346, 5.508}, {60, 0.5550, 15.4051, 6.45}}},
    {  "Propylene Ref"  , "Promix NR"   ,354.9,   0.000,  0.0000,  0.0000,   42.565  ,  12.027,  1.765, 11,{{-40, 0.5776, 6.011, 2.855},{-30, 0.5776, 6.011, 2.855},{-20, 0.5657, 7.282, 3.601},{-10, 0.5534, 9.896, 5.087},{0, 0.5412, 12.336, 6.582}, {10, 0.5277, 15.276, 8.449}, {20, 0.5135, 18.759, 10.742}, {30, 0.4985, 22.831, 13.521}, {40, 0.4825, 27.718, 16.955}, {50, 0.4657, 33.038, 20.855}, {60, 0.4480, 39.542, 25.733}}},
       {  "Gasolie"        , "Gasolie"     ,  0.0,   0.000,  0.0000,  0.0000,   28      ,  12.027,  1.765, 11,{{-40, 0.882671},{-30, 0.875826},{-20, 0.868982},{-10, 0.862137},{0, 0.855309}, {10, 0.848465}, {20, 0.841536}, {30, 0.834776}, {40, 0.82793}, {50, 0.821069}, {60, 0.814224}}},
    {  "Flexicoker LPG" , "FLX LPG"     ,  0.0,   0.000,  0.0000,  0.0000,   52.04934,  12.027,  1.765, 11,{{-40, 0.616096, -4.14, -1.63},{-30, 0.605316, -2.8, -1.13},{-20, 0.59426, -0.32, 0.13},{-10, 0.582651, 1.99, 0.82},{0, 0.571319, 5.12, 2.11} ,{10, 0.558881, 9.15, 3.73} ,{20, 0.546443, 14.05, 5.73} ,{30, 0.533176, 20.27, 8.15} ,{40, 0.519632, 28.05, 11.06}, {50, 0.505259, 37.72, 14.51}, {60, 0.490334, 50.75, 18.87}}},
    {  "Sulphur-1"      , "S"           ,429.7,   0.000,  0.0000,  0.0000,   32.065  ,  12.027,  1.765, 31,{{120, 1.802},{121, 1.801},{122 ,1.801},{123, 1.800},{124, 1.799}, {125, 1.798}, {126, 1.797}, {127, 1.797}, {128, 1.796}, {129, 1.795}, {130, 1.795}, {131, 1.794}, {132, 1.793}, {133, 1.792}, {134, 1.792}, {135, 1.791}, {136, 1.790}, {137, 1.789}, {138, 1.788}, {139, 1.788}, {140, 1.787}, {141, 1.786}, {142, 1.785}, {143, 1.785}, {144, 1.784}, {145, 1.783}, {146, 1.782}, {147, 1.781}, {148, 1.780}, {149, 1.780}, {150, 1.779}}},
    {  "Sulphur-2"      , "S"           ,429.7,   0.000,  0.0000,  0.0000,   32.065  ,  12.027,  1.765, 31,{{120, 1.7990},{121, 1.7984},{122 ,1.7978},{123, 1.7972},{124, 1.7966}, {125, 1.7960}, {126, 1.7954}, {127, 1.7948}, {128, 1.7942}, {129, 1.7936}, {130, 1.7930}, {131, 1.7924}, {132, 1.7918}, {133, 1.7912}, {134, 1.7906}, {135, 1.7900}, {136, 1.7894}, {137, 1.7888}, {138, 1.7882}, {139, 1.7876}, {140, 1.7870}, {141, 1.7864}, {142, 1.7858}, {143, 1.7852}, {144, 1.7846}, {145, 1.7840}, {146, 1.7834}, {147, 1.7828}, {148, 1.7822}, {149, 1.7816}, {150, 1.7810}}},
    {  "Sulphur-3"      , "S"           ,429.7,   0.000,  0.0000,  0.0000,   32.065  ,  12.027,  1.765, 31,{{120, 1.8039},{121, 1.8035},{122 ,1.8026},{123, 1.8019},{124, 1.8012}, {125, 1.8005}, {126, 1.7998}, {127, 1.7990}, {128, 1.7982}, {129, 1.7974}, {130, 1.7966}, {131, 1.7985}, {132, 1.7950}, {133, 1.7942}, {134, 1.7933}, {135, 1.7924}, {136, 1.7916}, {137, 1.7808}, {138, 1.7899}, {139, 1.7890}, {140, 1.7881}, {141, 1.7871}, {142, 1.7861}, {143, 1.7851}, {144, 1.7842}, {145, 1.7833}, {146, 1.7825}, {147, 1.7816}, {148, 1.7806}, {149, 1.7798}, {150, 1.7790}}},
    {  "Sulphur-4"      , "S"           ,429.7,   0.000,  0.0000,  0.0000,   32.065  ,  12.027,  1.765, 31,{{120, 1.8017},{121, 1.8010},{122 ,1.8003},{123, 1.7996},{124, 1.7989}, {125, 1.7982}, {126, 1.7975}, {127, 1.7968}, {128, 1.7960}, {129, 1.7952}, {130, 1.7945}, {131, 1.7938}, {132, 1.7930}, {133, 1.7922}, {134, 1.7915}, {135, 1.7908}, {136, 1.7900}, {137, 1.7893}, {138, 1.7885}, {139, 1.7878}, {140, 1.7870}, {141, 1.7863}, {142, 1.7857}, {143, 1.7849}, {144, 1.7842}, {145, 1.7835}, {146, 1.7828}, {147, 1.7821}, {148, 1.7814}, {149, 1.7806}, {150, 1.7799}}},
    {  "Sulphur-5"      , "S"           ,429.7,   0.000,  0.0000,  0.0000,   32.065  ,  12.027,  1.765, 31,{{120, 1.7974},{121, 1.7968},{122 ,1.7962},{123, 1.7956},{124, 1.7950}, {125, 1.7944}, {126, 1.7938}, {127, 1.7932}, {128, 1.7926}, {129, 1.7920}, {130, 1.7914}, {131, 1.7908}, {132, 1.7902}, {133, 1.7896}, {134, 1.7890}, {135, 1.7884}, {136, 1.7878}, {137, 1.7872}, {138, 1.7866}, {139, 1.7860}, {140, 1.7854}, {141, 1.7848}, {142, 1.7842}, {143, 1.7836}, {144, 1.7830}, {145, 1.7824}, {146, 1.7818}, {147, 1.7812}, {148, 1.7806}, {149, 1.7800}, {150, 1.7794}}},
    {  "Sulphur-6"      , "S"           ,429.7,   0.000,  0.0000,  0.0000,   32.065  ,  12.027,  1.765, 31,{{120, 1.8008},{121, 1.8001},{122 ,1.7996},{123, 1.7989},{124, 1.7981}, {125, 1.7974}, {126, 1.7967}, {127, 1.7962}, {128, 1.7954}, {129, 1.7946}, {130, 1.7941}, {131, 1.7939}, {132, 1.7926}, {133, 1.7918}, {134, 1.7913}, {135, 1.7905}, {136, 1.7898}, {137, 1.7890}, {138, 1.7882}, {139, 1.7877}, {140, 1.7869}, {141, 1.7861}, {142, 1.7854}, {143, 1.7848}, {144, 1.7840}, {145, 1.7832}, {146, 1.7825}, {147, 1.7817}, {148, 1.7810}, {149, 1.7804}, {150, 1.7797}}},
};

/* The following code was included but not used by Henri Systems */

double ChemgasPureGasCalcLiquid(double Q, double F, double A, double B, double ActTemp)
{
    // Most likely a modified Rackett Eq’n (1970), for the calculation of molar volume of sat’d liquid.
    // The code is based on the code marked Original and is an attremt to understand and find the methode
    // the calculations is based on
    double Zra  = B;    // Rename paramters later
    double Tc   = Q;    // Rename paramters later
    double Tr   = (ActTemp + TEMP_ZERO)/Tc;
    double Vc   = A;    // Rename paramters later
    double Z    = F;    // Compressibility???
    double Vsat = Vc * ( powl ( Zra, -powl(1-Tr,double(2)/double(7))));
    double Dns  = Z*Vsat;
    return Dns;
    /* Original code from here :*/
    double R,t1,t2,t3,D;

    if (Q>0)
        R=(ActTemp+TEMP_ZERO)/Q;
    else
        R=1;
    t1=(double)(2)/(double)(7);
    t2= 1-R;
    t3=-powl(t2,t1);
    t2= powl(B ,t3);
    D = F*A*t2;
    if ((D>0.3)&&(D<1.5))
        return (D);
    return (0);
    */
}
/* The following code was included but not used by Henri Systems */

double ChemgasPureGasCalcVapour(double MolMass, double H, double N, double ActTemp, double ActAbsPress)
{
    double t1,t2,t3;
    //double GasWeight    = GasVolume*54.67*(Pressure* MH2O_TO_BAR+NORMAL_ATM)/(84.6*(TEMP_ZERO+Temperature));

    t1=(ActAbsPress/100.0)*MolMass/(ActTemp+TEMP_ZERO);
    t2=t1*H;
    t3=powl((N*t1),2);
    t3+=t2;

    if (t3>0)
        return (t3);
    return (0);
}


// The following calculations are used in systems delivered to Henri Systems
// The code return 54.67*((Press+AIPressSensor::AtmPressure)* MH2O_TO_BAR+NORMAL_ATM)/(84.6*(TEMP_ZERO+Temp));
// is from Hashi Energy. They got it from Agip

double CargoTypeObject::GasDensity(double Temp, double Press)
{
    if ( BaseCargoType >= CTY_GAS_AMMONIA ) {
        int ProductIndex = BaseCargoType - CTY_GAS_AMMONIA;
        GasProduct *GasPtr = (GasProduct*)&Product[ProductIndex];

        if ( GasPtr->TabEntries ) {
            return GetVapDensityFromTable(Temp,Press,GasPtr->DnsTable,GasPtr->TabEntries);
        } else {
            return 0.0;//ChemgasPureGasCalcVapour(GasPtr->MolMass,GasPtr->H,GasPtr->N,Temp,Press);
        }

    } else {
        return 54.67*((Press+AIPressSensor::AtmPressure)* MH2O_TO_BAR+NORMAL_ATM)/(84.6*(TEMP_ZERO+Temp));
    }

}

/* The following calculations are used in systems delivered to Henri Systems */

double CargoTypeObject::GetLiqDensityFromTable(double Temp, DnsInfo Table[], int Entries)
{
    if ( !Entries ) return 0.0;
    int  i=0;
    float RetVal;
    if ( Entries == 1 ) {
        return(Table[0].DensitySolid);
    }
    if ( Table[0].Temp > Table[1].Temp ) {
        while ( ( i < Entries ) && ( Table[i].Temp > Temp ) ) i++;
    } else {
        while ( ( i < Entries ) && ( Table[i].Temp < Temp ) ) i++;
    }

    if ( i > Entries-1 ) {
        RetVal = Table[Entries-1].DensitySolid;
    } else {
        if ( !i )   i++;
        RetVal = IntPol1stDeg(Table[i-1].Temp,Table[i].Temp,Table[i-1].DensitySolid,Table[i].DensitySolid,Temp);
    }
    return(RetVal);

}
/* The following calculations are used in systems delivered to Henri Systems */

double CargoTypeObject::GetVapDensityFromTable(double Temp, double Press, DnsInfo Table[], int Entries)
{
    if ( !Entries ) return 0.0;
    int    i        =0;
    if ( Entries == 1 ) {
        return(Table[0].DensitySolid);
    }
    if ( Table[0].Temp > Table[1].Temp ) {
        while ( ( i < Entries ) && ( Table[i].Temp > Temp ) ) i++;
    } else {
        while ( ( i < Entries ) && ( Table[i].Temp < Temp ) ) i++;
    }

    if ( !i ) {
        i++;
    } else if ( i > Entries-1 ) {
        i = Entries-1;
    }
    Press *= MH2O_TO_BAR;
    double VapPress = IntPol1stDeg(Table[i-1].Temp,Table[i].Temp,Table[i-1].Pressure,Table[i].Pressure,Temp);
    //double DnsLiq = IntPol1stDeg(Table[i-1].Temp,Table[i].Temp,Table[i-1].DensitySolid,Table[i].DensitySolid,Temp);
    // The density unit for vapour must be converted to tom/m3
    double DnsVap   = IntPol1stDeg(Table[i-1].Temp,Table[i].Temp,Table[i-1].DensityVapor,Table[i].DensityVapor,Temp)/1000.0;
    double Density  = Press * DnsVap/VapPress;

    return(Density);

}


