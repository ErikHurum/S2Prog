#include "windows.h"
#include <System.hpp>
#include <SysInit.hpp>
#include <Winapi.Windows.hpp>
#include <System.Classes.hpp>
#include <System.Types.hpp>
#include <System.UITypes.hpp>
#include <Vcl.Controls.hpp>
#include <Vcl.Graphics.hpp>
#include <Winapi.GDIPAPI.hpp>
#include <Winapi.GDIPOBJ.hpp>
#include "ANWinInc.h"
#include "ChildUnit.h"
#include "Anpro_Net.h"
#include "MainUnit.h"
#pragma hdrstop

#include "CommunicationSetupUnit.h"
//---------------------------------------------------------------------------
#pragma package(smart_init)
#pragma link "nrcommbox"
#pragma resource "*.dfm"
TComSetupDlg *ComSetupDlg;
//---------------------------------------------------------------------------
__fastcall TComSetupDlg::TComSetupDlg(TComponent* Owner)
	: TForm(Owner)
{
}
//---------------------------------------------------------------------------
void __fastcall TComSetupDlg::ComRadioGroupClick(TObject *Sender)
{
	if (!InCreate) {
		switch(ComRadioGroup->ItemIndex){
		case 0:
			  locDataSourceName 	= nrDeviceBox1->Text;
			  SearchBitBtn->Visible	= true;
			  InfoLabel->Visible 	= false;
			  break;
		case 1:
			  locDataSourceName 	= "Network";
			  SearchBitBtn->Visible	= false;
			  InfoLabel->Visible 	= true;
			  break;
		case 2:
			  locDataSourceName 	= "AnproNet";
			  SearchBitBtn->Visible	= false;
			  InfoLabel->Visible 	= true;
			  break;
		case 3:
			  locDataSourceName 	= "NoCom";
			  SearchBitBtn->Visible	= false;
			  InfoLabel->Visible 	= true;
			  break;
		case 4:
			  locDataSourceName 	= "Simulator";
			  SearchBitBtn->Visible	= false;
			  InfoLabel->Visible 	= true;
			  break;
		}
	}
}
//---------------------------------------------------------------------------
void __fastcall TComSetupDlg::BitBtn1Click(TObject *Sender)
{
	DataSourceName   = locDataSourceName;
}
//---------------------------------------------------------------------------
void __fastcall TComSetupDlg::FormClose(TObject *Sender,
	  TCloseAction &Action)
{
		Action = caFree;

}
//---------------------------------------------------------------------------
void __fastcall TComSetupDlg::SearchBitBtnClick(TObject *Sender)
{
	MainForm->CurrentSearchComPortIndex			= 0;
	MainForm->FindComPort 		 				= true;
	MainForm->NetReceiveRestartTimer->Enabled 	= true;
}
//---------------------------------------------------------------------------











void __fastcall TComSetupDlg::nrDeviceBox1Change(TObject *Sender)
{
	locDataSourceName = nrDeviceBox1->Text;
}
//---------------------------------------------------------------------------


void __fastcall TComSetupDlg::FormCreate(TObject *Sender)
{
	InCreate                     = true;

	int comnr =0;
	if( DataSourceName.SubString(0,3) == "Com"){
		locDataSourceName = DataSourceName;
	}else if( DataSourceName == "Network"){
		locDataSourceName = "Network";
		comnr = 1;
	} else if( DataSourceName == "AnproNet") {
		locDataSourceName = "AnproNet";
		comnr = 2;
	}else if(( DataSourceName == "NoCom")||( DataSourceName == "Com0")){
		locDataSourceName = "NoCom";
		comnr = 3;
	}else if( DataSourceName == "Simulator"){
		locDataSourceName = "Simulator";
		comnr = 4;
	}
	ComRadioGroup->ItemIndex 	 = comnr;
	InCreate                     = false;

}
//---------------------------------------------------------------------------

