#include <vcl.h>
#include "ConstantsANWIN.h"
#include "TSNIncludes.h"
#include "MainUnit.h"
#pragma hdrstop

#include "CommunicationSetupUnit.h"
//---------------------------------------------------------------------------
#pragma package(smart_init)
#pragma link "nrcommbox"
#pragma resource "*.dfm"
TComSetupDlg *ComSetupDlg;
//---------------------------------------------------------------------------
__fastcall TComSetupDlg::TComSetupDlg(TComponent* Owner)
	: TForm(Owner)
{
	  int comnr =0;
	  if(MainForm->DataSourceName.SubString(0,3) == "Com"){
		DataSourceName = MainForm->DataSourceName;
	  }else if(MainForm->DataSourceName == "Network"){
		DataSourceName = "Network";
		comnr = 1;
		ComParametersPanel->Visible = false;
	  } else if(MainForm->DataSourceName == "AnproNet") {
		DataSourceName = "AnproNet";
		comnr = 2;
		ComParametersPanel->Visible = false;
	  }else if((MainForm->DataSourceName == "NoCom")||(MainForm->DataSourceName == "Com0")){
		DataSourceName = "NoCom";
		comnr = 3;
	  }else if(MainForm->DataSourceName == "Simulator"){
		DataSourceName = "Simulator";
		comnr = 4;
		ComParametersPanel->Visible = false;
	  }
	  ComRadioGroup->ItemIndex 	   = comnr;
}
//---------------------------------------------------------------------------
void __fastcall TComSetupDlg::ComRadioGroupClick(TObject *Sender)
{
  switch(ComRadioGroup->ItemIndex){
	case 0:
	  DataSourceName = nrDeviceBox1->Text;
	  IPAdressGroupBox->Visible 	= false;
	  SearchBitBtn->Visible			= true;
	  InfoLabel->Visible 			= false;
	  ComParametersPanel->Visible   = true;
	  break;
	case 1:
	  DataSourceName = "Network";
	  IPAdressGroupBox->Visible 	= false;
	  SearchBitBtn->Visible			= false;
	  InfoLabel->Visible 			= true;
	  ComParametersPanel->Visible   = false;
	  break;
	case 2:
	  DataSourceName = "AnproNet";
	  IPAdressGroupBox->Visible 	= false;
	  SearchBitBtn->Visible			= false;
	  InfoLabel->Visible 			= true;
	  ComParametersPanel->Visible   = false;
	  break;
	case 3:
	  DataSourceName = "NoCom";
	  IPAdressGroupBox->Visible 	= false;
	  SearchBitBtn->Visible			= false;
	  InfoLabel->Visible 			= true;
	  ComParametersPanel->Visible   = false;
	  break;
	case 4:
	  DataSourceName = "Simulator";
//      IPAdressGroupBox->Visible = true;
	  SearchBitBtn->Visible			= false;
	  InfoLabel->Visible 			= true;
	  ComParametersPanel->Visible   = false;
	  break;
  }
}
//---------------------------------------------------------------------------
void __fastcall TComSetupDlg::BitBtn1Click(TObject *Sender)
{
	MainForm->DataSourceName   = DataSourceName;
}
//---------------------------------------------------------------------------
void __fastcall TComSetupDlg::FormClose(TObject *Sender,
	  TCloseAction &Action)
{
		Action = caFree;

}
//---------------------------------------------------------------------------
void __fastcall TComSetupDlg::SearchBitBtnClick(TObject *Sender)
{
	MainForm->CurrentSearchComPortIndex			= 0;
	MainForm->FindComPort 		 				= true;
	MainForm->NetReceiveRestartTimer->Enabled 	= true;
}
//---------------------------------------------------------------------------











void __fastcall TComSetupDlg::nrDeviceBox1Change(TObject *Sender)
{
	DataSourceName           = nrDeviceBox1->Text;
	MainForm->DataSourceName = nrDeviceBox1->Text;
}
//---------------------------------------------------------------------------


